<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parentâ€“Child Emotion Translator | Good4Parents â¤ï¸ Good4Children</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px 40px;
      text-align: center;
    }
    .header h1 {
      font-size: 2.2em;
      margin-bottom: 8px;
    }
    .header .subtitle {
      font-size: 1.05em;
      opacity: 0.98;
      line-height: 1.7;
      max-width: 720px;
      margin: 0 auto;
    }
    .header .subtitle span {
      display: block;
      font-size: 0.9em;
      opacity: 0.9;
      margin-top: 6px;
    }
    
    .tab-navigation {
      display: flex;
      background: #f8f9fa;
      border-bottom: 2px solid #e9ecef;
    }
    .tab-button {
      flex: 1;
      padding: 16px;
      background: none;
      border: none;
      font-size: 1.02em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      color: #666;
      font-family: inherit;
    }
    .tab-button.active {
      background: white;
      color: #667eea;
      border-bottom: 3px solid #667eea;
    }
    .tab-button:hover {
      background: #e9ecef;
    }
    .tab-content {
      display: none;
      padding: 30px;
    }
    .tab-content.active {
      display: block;
    }

    /* Step indicator */
    .step-indicator {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding: 18px;
      background: #f8f9ff;
      border-radius: 12px;
      flex-wrap: wrap;
    }
    .step-dot {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #999;
      font-size: 1.1em;
    }
    .step-dot.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: scale(1.2);
    }
    .step-arrow {
      color: #ccc;
      font-size: 1.2em;
    }

    /* Age selector */
    .age-selector {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    .age-button {
      padding: 10px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 25px;
      background: white;
      cursor: pointer;
      font-size: 0.95em;
      font-weight: bold;
      transition: all 0.3s;
      font-family: inherit;
    }
    .age-button:hover {
      background: #f0f4ff;
    }
    .age-button.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    /* Scenario cards */
    .scenario-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .scenario-card {
      background: white;
      border: 3px solid #e0e0e0;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      user-select: none;
    }
    .scenario-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .scenario-card.active {
      border-color: #667eea;
      background: linear-gradient(135deg, #f0f4ff 0%, #e8ecff 100%);
      box-shadow: 0 8px 20px rgba(102,126,234,0.3);
    }
    .scenario-icon {
      font-size: 3.5em;
      margin-bottom: 10px;
    }
    .scenario-name {
      font-size: 1.02em;
      font-weight: bold;
      color: #333;
      margin-bottom: 4px;
    }
    .scenario-desc {
      font-size: 0.84em;
      color: #777;
      line-height: 1.4;
    }

    /* Emotion cards */
    .emotion-result {
      background: #fff9e6;
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      border-left: 5px solid #ffc107;
    }
    .emotion-title {
      font-size: 1.24em;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .emotion-items {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .emotion-badge {
      background: white;
      padding: 10px 16px;
      border-radius: 25px;
      font-size: 1em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      max-width: 100%;
    }
    .emotion-emoji {
      font-size: 1.25em;
    }
    .emotion-phrase {
      font-size: 0.84em;
      color: #777;
      margin-top: 4px;
      width: 100%;
    }

    /* Need cards */
    .need-result {
      background: #e8f5e9;
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      border-left: 5px solid #4caf50;
    }
    .need-title {
      font-size: 1.24em;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .need-items {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .need-badge {
      background: white;
      padding: 10px 16px;
      border-radius: 25px;
      font-size: 1em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
      max-width: 100%;
    }
    .need-phrase {
      font-size: 0.84em;
      color: #777;
      margin-top: 4px;
      width: 100%;
    }

    /* Response suggestions */
    .response-result {
      background: #e3f2fd;
      border-radius: 15px;
      padding: 25px;
      margin: 20px 0;
      border-left: 5px solid #2196f3;
    }
    .response-title {
      font-size: 1.24em;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .response-item {
      background: white;
      padding: 14px 14px 10px 14px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      font-size: 0.97em;
      color: #444;
      position: relative;
    }
    .response-number {
      display: inline-block;
      width: 24px;
      height: 24px;
      background: #2196f3;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 24px;
      margin-right: 8px;
      font-size: 0.9em;
      font-weight: bold;
    }
    .response-main {
      font-weight: 600;
      margin-bottom: 4px;
      display: inline-block;
    }
    .response-say {
      font-size: 0.93em;
      color: #555;
      margin-left: 30px;
    }
    .response-say strong {
      font-weight: 600;
    }
    .response-select {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.8em;
      color: #666;
      cursor: pointer;
    }
    .response-select input {
      cursor: pointer;
    }

    /* My reaction options */
    .reaction-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
      margin: 20px 0;
    }
    .reaction-card {
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 12px 15px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    .reaction-card:hover {
      background: #e9ecef;
    }
    .reaction-card.selected {
      background: #e8f5e9;
      border-color: #4caf50;
    }
    .reaction-checkbox {
      width: 20px;
      height: 20px;
      cursor: pointer;
      margin-top: 2px;
    }
    .reaction-text {
      font-size: 0.95em;
      color: #333;
      flex: 1;
      cursor: pointer;
      line-height: 1.5;
    }
    .reaction-label-main {
      font-weight: 600;
    }
    .reaction-label-sub {
      font-size: 0.86em;
      color: #666;
      margin-top: 2px;
      display: block;
    }

    /* Encouragement box */
    .encouragement-box {
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      border-left: 5px solid #ff9800;
    }
    .encouragement-title {
      font-size: 1.17em;
      font-weight: bold;
      color: #e65100;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .encouragement-content {
      font-size: 0.99em;
      line-height: 1.7;
      color: #555;
    }
    .encouragement-highlight {
      font-weight: 600;
      margin-bottom: 6px;
    }

    textarea {
      width: 100%;
      min-height: 80px;
      border-radius: 10px;
      border: 2px solid #dfe4ea;
      padding: 12px;
      font-size: 1em;
      font-family: inherit;
      resize: vertical;
      outline: none;
    }
    textarea:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }

    .btn {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 1.03em;
      font-weight: 600;
      font-family: inherit;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102,126,234,0.35);
    }
    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }
    .btn-secondary:hover {
      background: #667eea;
      color: white;
    }
    .btn-danger {
      background: #fff5f5;
      color: #e53935;
      border: 1px solid #ffcdd2;
    }
    .btn-danger:hover {
      background: #ffcdd2;
      color: #b71c1c;
    }
    .btn-large {
      padding: 16px 32px;
      font-size: 1.15em;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-top: 25px;
    }

    .section-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .section-title {
      font-size: 1.33em;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-subtitle {
      font-size: 0.9em;
      color: #777;
      margin-bottom: 10px;
      font-style: italic;
    }

    .hint-text {
      font-size: 0.9em;
      color: #666;
      margin-top: 8px;
      font-style: italic;
    }

    .note-box {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-top: 15px;
      min-height: 150px;
      white-space: pre-wrap;
      line-height: 1.8;
      font-size: 0.98em;
      color: #333;
    }
    .note-placeholder {
      color: #999;
      font-style: italic;
    }
    .copy-hint {
      margin-top: 8px;
      font-size: 0.85em;
      color: #2e7d32;
      min-height: 1.2em;
    }

    /* Weekly review */
    .history-summary {
      background: #f0f4ff;
      border-radius: 12px;
      padding: 15px 18px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
      font-size: 0.95em;
      color: #34495e;
      line-height: 1.6;
      white-space: pre-wrap;
    }
    .history-item {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      border-left: 5px solid #667eea;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .history-date {
      font-weight: bold;
      color: #667eea;
      font-size: 1.02em;
    }
    .history-scenario {
      background: #f0f4ff;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.88em;
      color: #667eea;
    }
    .history-content {
      font-size: 0.94em;
      line-height: 1.6;
      color: #555;
    }
    .empty-history {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }
    .empty-history-icon {
      font-size: 4em;
      margin-bottom: 15px;
    }

    /* References */
    .reference-section {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin-top: 30px;
      border-left: 5px solid #607d8b;
    }
    .reference-title {
      font-size: 1.15em;
      font-weight: bold;
      color: #37474f;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .reference-list {
      font-size: 0.9em;
      line-height: 1.8;
      color: #555;
    }
    .reference-item {
      margin-bottom: 12px;
      padding-left: 20px;
      text-indent: -20px;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.6em;
      }
      .header .subtitle {
        font-size: 0.96em;
      }
      .scenario-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .step-indicator {
        padding: 15px 10px;
      }
      .step-dot {
        width: 35px;
        height: 35px;
        font-size: 1em;
      }
      .tab-button {
        font-size: 0.88em;
        padding: 12px 8px;
      }
      .reaction-options {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ¯ Parentâ€“Child Emotion Translator</h1>
    <p class="subtitle">
      Spend 3 minutes turning "that meltdown moment today" into:
      <br>Your child's possible inner voice + what was going on with you + 1â€“2 lines you could try next time.
      <span>You don't need to be a perfect parent. If you're willing to see your child and yourself, you're already moving forward.</span>
    </p>
  </div>

  <div class="tab-navigation">
    <button class="tab-button active" onclick="switchTab('translate')">ğŸ¯ Translate Today</button>
    <button class="tab-button" onclick="switchTab('note')">ğŸ“ Todayâ€™s Note</button>
    <button class="tab-button" onclick="switchTab('history')">ğŸ“Š Weekly Review</button>
  </div>

  <!-- Tab 1: Emotion translation -->
  <div id="translateTab" class="tab-content active">
    <!-- Step indicator -->
    <div class="step-indicator">
      <div class="step-dot active" id="stepDot1">1</div>
      <div class="step-arrow">â†’</div>
      <div class="step-dot" id="stepDot2">2</div>
      <div class="step-arrow">â†’</div>
      <div class="step-dot" id="stepDot3">3</div>
    </div>

    <!-- Step 1 -->
    <div id="step1" class="section-card">
      <div class="section-title">
        <span>1ï¸âƒ£</span> About how old is your child?
      </div>
      <p class="section-subtitle">
        Just pick the age range that feels roughly right. The translation will fit better if we know the stage, not the exact age.
      </p>
      
      <div class="age-selector">
        <button class="age-button active" onclick="selectAge('toddler', this)">1â€“3 yrs Â· Toddler</button>
        <button class="age-button" onclick="selectAge('preschool', this)">3â€“6 yrs Â· Preschool</button>
        <button class="age-button" onclick="selectAge('school', this)">6â€“12 yrs Â· School age</button>
      </div>

      <div class="section-title" style="margin-top: 30px;">
        What kind of situation was it today?
      </div>
      <p class="section-subtitle">
        Just pick the one that feels the closest. No need to overthink â€” this is just a starting point.
      </p>
      
      <div class="scenario-grid" id="scenarioGrid">
        <div class="scenario-card" onclick="selectScenario('separation', this)">
          <div class="scenario-icon">ğŸ«</div>
          <div class="scenario-name">Doesnâ€™t want to go to school / separation struggle</div>
          <div class="scenario-desc">Clinging, crying, refuses to say goodbye or go</div>
        </div>
        <div class="scenario-card" onclick="selectScenario('public_tantrum', this)">
          <div class="scenario-icon">ğŸ›’</div>
          <div class="scenario-name">Meltdown in public</div>
          <div class="scenario-desc">Crying, screaming in a supermarket, park, or other public place</div>
        </div>
        <div class="scenario-card" onclick="selectScenario('sibling_conflict', this)">
          <div class="scenario-icon">ğŸ‘§ğŸ‘¦</div>
          <div class="scenario-name">Sibling fights</div>
          <div class="scenario-desc">Fighting over toys, complaining, â€œThatâ€™s not fairâ€</div>
        </div>
        <div class="scenario-card" onclick="selectScenario('bedtime', this)">
          <div class="scenario-icon">ğŸŒ™</div>
          <div class="scenario-name">Refusing bedtime</div>
          <div class="scenario-desc">â€œIâ€™m not sleepyâ€, keeps playing, stalling for a long time</div>
        </div>
        <div class="scenario-card" onclick="selectScenario('transition', this)">
          <div class="scenario-icon">â±ï¸</div>
          <div class="scenario-name">Doesnâ€™t want to clean up / transition</div>
          <div class="scenario-desc">Asked to clean up or switch tasks, and they drag their feet or flat-out refuse</div>
        </div>
        <div class="scenario-card" onclick="selectScenario('mealtime', this)">
          <div class="scenario-icon">ğŸ½ï¸</div>
          <div class="scenario-name">Mealtime battles</div>
          <div class="scenario-desc">Takes forever, plays instead of eating, says theyâ€™re not hungry</div>
        </div>
        <div class="scenario-card" onclick="selectScenario('other', this)">
          <div class="scenario-icon">ğŸ˜µ</div>
          <div class="scenario-name">Hard to describe, just a rough day</div>
          <div class="scenario-desc">Doesnâ€™t quite fit above, or lots of small things stacked up</div>
        </div>
      </div>

      <div style="margin-top: 25px;">
        <label style="font-weight: bold; color: #333; margin-bottom: 8px; display: block;">
          Want to jot down what happened? (optional)
        </label>
        <textarea id="scenarioText" placeholder="Example: Right before we had to leave, they started crying hard. I lost it and ended up yelling. (You can also leave this blank.)"></textarea>
        <div class="hint-text">
          You donâ€™t have to type anything. If you do, the translation can be a bit more tailored to your situation.
        </div>
      </div>

      <div class="button-row">
        <button class="btn btn-primary btn-large" onclick="showStep2()">
          See what might be going on for my child â†’
        </button>
      </div>
    </div>

    <!-- Step 2 -->
    <div id="step2" class="section-card hidden">
      <div class="section-title">
        <span>2ï¸âƒ£</span> Translation: What might be happening inside my child?
      </div>
      <p class="section-subtitle">
        These are just possibilities, not â€œthe truthâ€. Pick the lines that feel closest â€” theyâ€™re conversation starters, not diagnoses.
      </p>

      <!-- Child's feelings -->
      <div class="emotion-result">
        <div class="emotion-title">
          <span>ğŸ’­</span> How your child might be feeling (you can say these out loud to them)
        </div>
        <div class="emotion-items" id="emotionItems"></div>
      </div>

      <!-- Child's needs -->
      <div class="need-result">
        <div class="need-title">
          <span>ğŸ’š</span> What your child might really need (beyond â€œjust listenâ€)
        </div>
        <div class="need-items" id="needItems"></div>
      </div>

      <!-- What I can say/do -->
      <div class="response-result">
        <div class="response-title">
          <span>ğŸ’¡</span> 1â€“2 things I could try next time (tick the ones youâ€™d like to practice)
        </div>
        <div id="responseItems"></div>
      </div>

      <div class="button-row">
        <button class="btn btn-secondary" onclick="showStep1()">â† Back</button>
        <button class="btn btn-primary btn-large" onclick="showStep3()">Log my reaction â†’</button>
      </div>
    </div>

    <!-- Step 3 -->
    <div id="step3" class="section-card hidden">
      <div class="section-title">
        <span>3ï¸âƒ£</span> How did I react in that moment? (you can tick more than one)
      </div>
      <p class="section-subtitle">
        Thereâ€™s no score here and no â€œgood/bad parentâ€ label. This is just to help you notice your usual patterns.
      </p>

      <div class="reaction-options" id="reactionOptions">
        <div class="reaction-card" onclick="toggleReaction('raiseVoice', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_raiseVoice">
          <label class="reaction-text" for="r_raiseVoice">
            <span class="reaction-label-main">ğŸ“¢ My emotions got pretty big</span>
            <span class="reaction-label-sub">For example: my voice got louder, I yelled, or my tone got sharp</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('threaten', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_threaten">
          <label class="reaction-text" for="r_threaten">
            <span class="reaction-label-main">âš ï¸ I used â€œIf you do X, then Iâ€™ll Yâ€ kinds of threats</span>
            <span class="reaction-label-sub">Like: â€œIf you donâ€™t stop crying, weâ€™re not going outâ€, â€œIf you donâ€™t listen, Iâ€™ll take your toys awayâ€</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('giveUp', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_giveUp">
          <label class="reaction-text" for="r_giveUp">
            <span class="reaction-label-main">ğŸ¤· I ended up giving in / dropping my boundary</span>
            <span class="reaction-label-sub">Like: â€œWhatever, do what you wantâ€ or â€œFine, Iâ€™ll just say yes and deal with it laterâ€</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('cold', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_cold">
          <label class="reaction-text" for="r_cold">
            <span class="reaction-label-main">ğŸ§Š I pulled back and stopped engaging for a while</span>
            <span class="reaction-label-sub">Like: ignoring them on purpose, going silent, needing distance before I could talk</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('compare', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_compare">
          <label class="reaction-text" for="r_compare">
            <span class="reaction-label-main">ğŸ‘¥ I compared them to someone else</span>
            <span class="reaction-label-sub">Like: â€œLook, other kids can do thisâ€, â€œYour sibling doesnâ€™t act like thisâ€</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('label', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_label">
          <label class="reaction-text" for="r_label">
            <span class="reaction-label-main">ğŸ·ï¸ I used labels</span>
            <span class="reaction-label-sub">Like: â€œYouâ€™re so lazyâ€, â€œYouâ€™re always like thisâ€, â€œYouâ€™re impossibleâ€</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('empathy', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_empathy">
          <label class="reaction-text" for="r_empathy">
            <span class="reaction-label-main">ğŸ’™ I named their feelings first</span>
            <span class="reaction-label-sub">Like: â€œYouâ€™re really mad right now, huh?â€, â€œYouâ€™re actually really sad about thisâ€</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('boundary', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_boundary">
          <label class="reaction-text" for="r_boundary">
            <span class="reaction-label-main">ğŸ¯ I set a kind but firm boundary</span>
            <span class="reaction-label-sub">Like: â€œI know you donâ€™t want to, and we still need toâ€¦â€, â€œI get it, and the answer is still noâ€</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('repair', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_repair">
          <label class="reaction-text" for="r_repair">
            <span class="reaction-label-main">ğŸ¤ I tried to repair afterwards</span>
            <span class="reaction-label-sub">For example: apologising, offering a hug, talking things through after we both cooled off</span>
          </label>
        </div>
        <div class="reaction-card" onclick="toggleReaction('tiredBlank', this, event)">
          <input type="checkbox" class="reaction-checkbox" id="r_tiredBlank">
          <label class="reaction-text" for="r_tiredBlank">
            <span class="reaction-label-main">ğŸ˜µ I was exhausted and my brain went blank</span>
            <span class="reaction-label-sub">In that moment I just wanted it to be over, and had no energy left to think or be â€œintentionalâ€</span>
          </label>
        </div>
      </div>

      <div class="button-row">
        <button class="btn btn-secondary" onclick="showStep2()">â† Back</button>
        <button class="btn btn-primary btn-large" onclick="goToNote()">Done â†’ See todayâ€™s note</button>
      </div>
    </div>
  </div>

  <!-- Tab 2: Note -->
  <div id="noteTab" class="tab-content">
    <div class="section-card">
      <div class="section-title">
        <span>ğŸ“</span> Todayâ€™s parenting note
      </div>
      
      <p style="color: #666; margin-bottom: 15px;">
        This note is auto-generated based on what you just chose. You can copy it into your notes app, a message to your partner, or wherever you like â€” treat it as your â€œpractice logâ€.
      </p>

      <div class="note-box" id="noteBox">
        <span class="note-placeholder">After you finish the 3 steps on the left, a short reflection will show up here.</span>
      </div>

      <!-- Encouragement section -->
      <div id="encouragementSection"></div>

      <div class="button-row">
        <button class="btn btn-primary" onclick="regenerateNote()">ğŸ”„ Regenerate note</button>
        <button class="btn btn-secondary" onclick="copyNote()">ğŸ“‹ Copy text</button>
      </div>
      <div id="copyHint" class="copy-hint"></div>
    </div>

    <div class="section-card" style="background: #e8f5e9; border-left: 5px solid #4caf50;">
      <div class="section-title" style="color: #2e7d32;">
        <span>ğŸ’¡</span> Gentle reminders
      </div>
      <ul style="padding-left: 25px; line-height: 1.8; color: #444; font-size: 0.95em;">
        <li>You donâ€™t have to handle every single situation perfectly. What matters more is that you pause and look at â€œwhat actually just happenedâ€.</li>
        <li>Looking back about once a week, youâ€™ll start to notice: youâ€™re not parenting the way you used to.</li>
        <li>You can also share these notes with your partner and turn them into â€œtiny agreementsâ€ between you two.</li>
      </ul>
    </div>

    <!-- References (APA 7th) -->
    <div class="reference-section">
      <div class="reference-title">
        <span>ğŸ“š</span> Research and books behind this tool
      </div>
      <div class="reference-list">
        <div class="reference-item">
          Cooper, G., Hoffman, K., Powell, B., &amp; Marvin, R. (2005). The Circle of Security intervention: Differential diagnosis and differential treatment. In L. J. Berlin, Y. Ziv, L. Amaya-Jackson, &amp; M. T. Greenberg (Eds.), <i>Enhancing early attachments: Theory, research, intervention, and policy</i> (pp. 127â€“151). Guilford Press.
        </div>
        <div class="reference-item">
          Faber, A., &amp; Mazlish, E. (2012). <i>How to talk so kids will listen &amp; listen so kids will talk</i>. Scribner. (Original work published 1980)
        </div>
        <div class="reference-item">
          Gottman, J. M., Katz, L. F., &amp; Hooven, C. (1997). <i>Meta-emotion: How families communicate emotionally</i>. Lawrence Erlbaum Associates.
        </div>
        <div class="reference-item">
          Kennedy-Moore, E., &amp; Lowenthal, M. S. (2011). <i>Smart parenting for smart kids: Nurturing your child's true potential</i>. Jossey-Bass.
        </div>
        <div class="reference-item">
          Neff, K. D., &amp; Faso, D. J. (2015). Self-compassion and well-being in parents of children with autism. <i>Mindfulness, 6</i>(4), 938â€“947. https://doi.org/10.1007/s12671-014-0322-0
        </div>
        <div class="reference-item">
          Siegel, D. J., &amp; Bryson, T. P. (2011). <i>The whole-brain child: 12 revolutionary strategies to nurture your child's developing mind</i>. Delacorte Press.
        </div>
      </div>
    </div>
  </div>

  <!-- Tab 3: Weekly review -->
  <div id="historyTab" class="tab-content">
    <div class="section-card">
      <div class="section-title">
        <span>ğŸ“Š</span> Last 7 days snapshot
      </div>

      <div id="historySummary" class="history-summary hidden"></div>
      
      <div id="historyList">
        <div class="empty-history">
          <div class="empty-history-icon">ğŸ“­</div>
          <p>No entries yet. Once you complete a translation, itâ€™ll show up here.</p>
          <p style="font-size: 0.9em; color: #999; margin-top: 8px;">You can start with just one moment that stood out today.</p>
        </div>
      </div>

      <div class="button-row" style="margin-top: 10%;">
        <button class="btn btn-danger" onclick="clearAllRecords()">ğŸ§¹ Clear all saved records</button>
      </div>
    </div>
  </div>
</div>

<script>
  // === Scenario templates (age-based) ===
  const scenarioTemplates = {
    separation: {
      name: 'Doesnâ€™t want to go to school / separation struggle',
      icon: 'ğŸ«',
      ageVariants: {
        toddler: {
          emotions: [
            { emoji: 'ğŸ˜¨', text: 'Scared you might disappear once you leave', keywords: ['cry', 'hug', 'hold on', 'mom', 'dad'], phrase: 'â€œAre you scared that once mommy leaves, you might never see me again?â€' },
            { emoji: 'ğŸ˜¢', text: 'Doesnâ€™t really understand why you have to separate', keywords: ['why', 'donâ€™t want', 'no'], phrase: 'â€œIt kind of makes no sense to you that we have to be apart, it just feels awful.â€' },
            { emoji: 'ğŸ˜°', text: 'Feels nervous around unfamiliar people', keywords: ['stranger', 'donâ€™t know', 'new'], phrase: 'â€œThere are a lot of people here you donâ€™t really know, and that makes you feel a bit scared.â€' }
          ],
          needs: [
            { emoji: 'ğŸ›¡ï¸', text: 'To be held and soothed physically', keywords: ['hug', 'cry', 'cling'], phrase: 'Extra cuddles first, so their body can feel safe before we talk.' },
            { emoji: 'ğŸ’•', text: 'To hear again and again that youâ€™ll come back', keywords: ['back', 'pick up', 'come'], phrase: 'You can calmly repeat: â€œMommy will definitely come back to pick you up.â€' },
            { emoji: 'ğŸ¯', text: 'A simple, predictable goodbye ritual', keywords: ['bye', 'wave', 'go'], phrase: 'For example: hug + high five + â€œSee you laterâ€ every time you say goodbye.' }
          ],
          responses: [
            { main: 'Start with comfort in their body, then explain youâ€™re coming back.', say: 'â€œLet me give you a big hug first. I need to go to work for a bit, and Iâ€™ll be back before the sun goes down.â€' },
            { main: 'Make the time youâ€™ll return feel more â€œvisibleâ€.', say: 'â€œWhen the clock hand moves to here, Iâ€™ll be standing right at the door. You can count in your head if you want.â€' },
            { main: 'Create a simple goodbye ritual you both repeat.', say: 'â€œLetâ€™s do our three high-fives and say â€˜See you soonâ€™, then Iâ€™ll head out, okay?â€' }
          ]
        },
        preschool: {
          emotions: [
            { emoji: 'ğŸ˜¨', text: 'Worried you might forget to pick them up', keywords: ['pick up', 'come back', 'forget', 'will you'], phrase: 'â€œAre you wondering, â€˜What if no one comes to pick me up?â€™â€' },
            { emoji: 'ğŸ˜¢', text: 'Doesnâ€™t want to leave the comfort of home', keywords: ['donâ€™t want', 'home', 'leave'], phrase: 'â€œHome feels really cozy and safe, so itâ€™s hard to leave all of a sudden.â€' },
            { emoji: 'ğŸ˜°', text: 'Just nervous about separation itself', keywords: ['nervous', 'donâ€™t want to go', 'scared'], phrase: 'â€œSaying goodbye and being away from mom or dad makes your whole body tense up.â€' }
          ],
          needs: [
            { emoji: 'ğŸ›¡ï¸', text: 'A clear sense of when exactly youâ€™ll see each other again', keywords: ['when', 'how long', 'what time'], phrase: 'Use simple time + place, like â€œafter snack time Iâ€™ll be at the gateâ€.' },
            { emoji: 'ğŸ’•', text: 'To bring a small â€œpiece of youâ€ with them', keywords: ['bring', 'take', 'thing'], phrase: 'Maybe a small handkerchief, photo, or tiny item that reminds them of you.' },
            { emoji: 'ğŸ“…', text: 'A less rushed morning routine', keywords: ['rushed', 'late', 'hurry'], phrase: 'A bit of margin so itâ€™s not only â€œweâ€™re late, hurry up!â€, but some actual connection time.' }
          ],
          responses: [
            { main: 'Name their mix of â€œnot wanting to goâ€ and nervousness.', say: 'â€œYou feel both sad to leave and a bit nervous inside, thatâ€™s a lot of big feelings.â€' },
            { main: 'Offer something small they can take as a comfort object.', say: 'â€œDo you want to bring my little handkerchief or this tiny toy with you? It can keep you company until Iâ€™m back.â€' },
            { main: 'Make a very specific plan about pickup.', say: 'â€œWhen the big clock says 3 oâ€™clock, Iâ€™ll be waiting right by the door. Letâ€™s pinky promise.â€' }
          ]
        },
        school: {
          emotions: [
            { emoji: 'ğŸ˜Ÿ', text: 'Worried about getting along with classmates', keywords: ['friend', 'classmate', 'donâ€™t like', 'left out'], phrase: 'â€œIs it kind of awkward or hard with some classmates lately?â€' },
            { emoji: 'ğŸ˜”', text: 'Feeling pressure from homework or tests', keywords: ['homework', 'test', 'canâ€™t do it', 'study'], phrase: 'â€œAll the homework and tests feel like too much, like you can barely keep up.â€' },
            { emoji: 'ğŸ˜¤', text: 'Frustrated that they â€œhave toâ€ go to school', keywords: ['why', 'donâ€™t want to go', 'hate'], phrase: 'â€œYou might be thinking: Why do I have to go every single day? Itâ€™s so annoying.â€' }
          ],
          needs: [
            { emoji: 'ğŸ‘‚', text: 'Someone to actually hear â€œwhatâ€™s been going onâ€', keywords: ['happened', 'teacher said', 'classmate'], phrase: 'A safe time to talk without being rushed or lectured.' },
            { emoji: 'ğŸ¯', text: 'Help with real problems, not just â€œtry harderâ€', keywords: ['what do I do', 'always', 'hard'], phrase: 'Practical ideas together work better than â€œyou just need to work harderâ€.' },
            { emoji: 'âš–ï¸', text: 'To be seen as â€œnot lazy, just overwhelmedâ€', keywords: ['hard', 'canâ€™t', 'trying'], phrase: 'They want you to notice how much theyâ€™re already trying, not just the results.' }
          ],
          responses: [
            { main: 'Invite them to tell you whatâ€™s been happening instead of jumping to advice.', say: 'â€œHas something been going on lately that makes you really not want to go? Iâ€™d like to hear about it.â€' },
            { main: 'Say out loud that you want to problem-solve together.', say: 'â€œIf your classmates keep doing this, what are some things we could try? Letâ€™s think of three options together.â€' },
            { main: 'Acknowledge their pressure and effort.', say: 'â€œThereâ€™s a lot of hard work on your plate, and I can see youâ€™ve been hanging in there.â€' }
          ]
        }
      }
    },
    public_tantrum: {
      name: 'Meltdown in public',
      icon: 'ğŸ›’',
      ageVariants: {
        toddler: {
          emotions: [
            { emoji: 'ğŸ˜ ', text: 'Sees something and feels they absolutely need it now', keywords: ['want', 'take', 'buy', 'give me'], phrase: 'â€œWhen you saw that thing, you felt like you just had to have it right now.â€' },
            { emoji: 'ğŸ˜¤', text: 'Canâ€™t understand why theyâ€™re not allowed', keywords: ['why', 'no', 'not allowed'], phrase: 'â€œYouâ€™re thinking: Why canâ€™t I have it? I donâ€™t get it, I just feel mad.â€' },
            { emoji: 'ğŸ˜«', text: 'Too tired / hungry / overstimulated', keywords: ['tired', 'hungry', 'too many people', 'loud'], phrase: 'â€œThere are lots of sounds, people, and youâ€™re also tired, so your feelings just explode.â€' }
          ],
          needs: [
            { emoji: 'ğŸ¼', text: 'Basic needs checked first (hungry / thirsty / tired)', keywords: ['hungry', 'thirsty', 'tired', 'sleepy'], phrase: 'Taking care of their body first often works better than asking them to â€œbe goodâ€.' },
            { emoji: 'ğŸ¯', text: 'Very simple, concrete rules', keywords: ['can', 'canâ€™t', 'rule'], phrase: 'Oneâ€“two clear sentences instead of a long explanation.' },
            { emoji: 'â°', text: 'A heads-up before leaving or changing activity', keywords: ['leave', 'go home', 'time to go'], phrase: 'Knowing â€œweâ€™ll leave soonâ€ helps more than a sudden stop.' }
          ],
          responses: [
            { main: 'Check hunger / tiredness first, then talk about rules.', say: 'â€œAre you feeling super tired or hungry right now? Letâ€™s have a sip of water first, then weâ€™ll talk.â€' },
            { main: 'Use one short sentence to explain why youâ€™re not buying it today.', say: 'â€œWeâ€™re not buying that today. Weâ€™re only getting what we need for dinner.â€' },
            { main: 'Give them a small â€œjobâ€ to help shift focus.', say: 'â€œCan you help me find the red apples? You can be my special helper.â€' }
          ]
        },
        preschool: {
          emotions: [
            { emoji: 'ğŸ˜ ', text: 'Very angry about wanting something and being told no', keywords: ['want', 'buy', 'I want it'], phrase: 'â€œYou really, really want it, and hearing â€˜noâ€™ feels super unfair.â€' },
            { emoji: 'ğŸ˜”', text: 'Feels itâ€™s unfair and very disappointing', keywords: ['why not', 'not fair', 'unfair'], phrase: 'â€œYouâ€™re thinking: Other kids get it, why canâ€™t I?â€' },
            { emoji: 'ğŸ˜¤', text: 'Feels misunderstood by adults', keywords: ['you never', 'you donâ€™t get it', 'you donâ€™t know'], phrase: 'â€œYou feel like the grown-ups just donâ€™t get how much this matters to you.â€' }
          ],
          needs: [
            { emoji: 'ğŸ‘‚', text: 'To have their â€œI really want thisâ€ feeling noticed', keywords: ['want', 'really want', 'I need it'], phrase: 'Hearing you say â€œI know you really want itâ€ helps more than instant lectures.' },
            { emoji: 'âš–ï¸', text: 'Clear and consistent rules', keywords: ['can I', 'why', 'rule'], phrase: 'Same basic rule most of the time feels safer than â€œdepends on momâ€™s moodâ€.' },
            { emoji: 'ğŸ¤', text: 'To feel respected in front of other people', keywords: ['everyone', 'looking', 'others'], phrase: 'Being yelled at publicly feels very embarrassing and can make the meltdown bigger.' }
          ],
          responses: [
            { main: 'Lead with empathy, not â€œStop itâ€ or â€œEnoughâ€.', say: 'â€œYou loved that toy, and when I said no you felt super angry and upset.â€' },
            { main: 'Repeat the rule calmly and consistently.', say: 'â€œI know you really want it. Today weâ€™re only buying things for dinner, not toys.â€' },
            { main: 'Offer a bit of choice to give some control back.', say: 'â€œItâ€™s okay to be mad, but we canâ€™t scream here. Do you want to hold my hand and walk, or go to a quieter spot with me?â€' }
          ]
        },
        school: {
          emotions: [
            { emoji: 'ğŸ˜’', text: 'Thinks youâ€™re being stingy or unfair', keywords: ['stingy', 'everyone else', 'why', 'unfair'], phrase: 'â€œYouâ€™re thinking: Other kids have this, why is it always no for me?â€' },
            { emoji: 'ğŸ˜¤', text: 'Annoyed at being treated â€œlike a babyâ€', keywords: ['Iâ€™m not', 'Iâ€™m already', 'grown up'], phrase: 'â€œYou feel like: Iâ€™m old enough, why canâ€™t I decide this myself?â€' },
            { emoji: 'ğŸ˜”', text: 'Genuinely really wants that thing', keywords: ['really want', 'always wanted', 'want it'], phrase: 'â€œYouâ€™re not just being difficult. You really like this thing a lot.â€' }
          ],
          needs: [
            { emoji: 'ğŸ’°', text: 'To understand money and family budget a bit more', keywords: ['money', 'expensive', 'how much', 'budget'], phrase: 'A simple picture of how your family uses money â€” not just â€œbecause I said soâ€.' },
            { emoji: 'ğŸ¯', text: 'To be part of the decision-making sometimes', keywords: ['can I', 'if', 'talk about'], phrase: 'Being asked for their opinion and planning together increases buy-in.' },
            { emoji: 'ğŸ“‹', text: 'Practice delaying gratification (not â€œneverâ€, just â€œnot nowâ€)', keywords: ['now', 'right now', 'wait'], phrase: 'â€œNot nowâ€ can feel less harsh if they know thereâ€™s a future option.' }
          ],
          responses: [
            { main: 'Open up a small â€œletâ€™s talk about moneyâ€ moment.', say: 'â€œYou really want this. Letâ€™s look at how much it costs and talk about it together.â€' },
            { main: 'Explain the budget side in a simple way.', say: 'â€œWeâ€™ve already spent this monthâ€™s extra money on other things. We can put this on our â€˜maybe next monthâ€™ list.â€' },
            { main: 'Offer a concrete way they could get it later.', say: 'â€œYou could save your pocket money, or we can think about it again for your birthday or a holiday.â€' }
          ]
        }
      }
    },
    sibling_conflict: {
      name: 'Sibling fights',
      icon: 'ğŸ‘§ğŸ‘¦',
      ageVariants: {
        toddler: {
          emotions: [
            { emoji: 'ğŸ˜¡', text: 'Explodes when something gets taken away', keywords: ['grab', 'mine', 'took'], phrase: 'â€œWhen your stuff gets taken, you just explode.â€' },
            { emoji: 'ğŸ˜¢', text: 'Canâ€™t express in words yet, so they cry or hit', keywords: ['cry', 'hit', 'push'], phrase: 'â€œRight now crying, pushing, or hitting is how you show youâ€™re not okay.â€' },
            { emoji: 'ğŸ˜¤', text: 'Convinced itâ€™s all the other kidâ€™s fault', keywords: ['he', 'she', 'all', 'started'], phrase: 'â€œYou feel sure the other one is totally wrong, and you feel very hurt.â€' }
          ],
          needs: [
            { emoji: 'ğŸ¯', text: 'Help putting their feelings into words', keywords: ['angry', 'sad', 'upset'], phrase: 'An adult who can say â€œYou felt really mad whenâ€¦â€ for them.' },
            { emoji: 'âš–ï¸', text: 'To learn what â€œtaking turnsâ€ means', keywords: ['turns', 'switch', 'wait'], phrase: 'Knowing itâ€™s not â€œI always loseâ€, but â€œwe take turnsâ€.' },
            { emoji: 'ğŸ›¡ï¸', text: 'Physical safety (no hitting / pushing / biting)', keywords: ['hit', 'push', 'bite'], phrase: 'First job is to keep everyoneâ€™s bodies safe, then talk about right/wrong.' }
          ],
          responses: [
            { main: 'Calmly block hitting or pushing first.', say: 'â€œI canâ€™t let you hit. Iâ€™m going to hold you for a moment â€” we can use words instead.â€' },
            { main: 'Help them describe what happened and how they felt.', say: 'â€œYouâ€™re really mad because the blocks were in your hands and then they got taken, right?â€' },
            { main: 'Use a timer or simple turn-taking rule.', say: 'â€œWeâ€™ll use a timer â€” 5 minutes for big brother, then 5 minutes for you.â€' }
          ]
        },
        preschool: {
          emotions: [
            { emoji: 'ğŸ˜¡', text: 'Gets very mad when things are grabbed', keywords: ['grab', 'took', 'mine'], phrase: 'â€œWhen your stuff gets grabbed, you feel super mad.â€' },
            { emoji: 'ğŸ˜’', text: 'Jealous, feels things are unfair', keywords: ['favour', 'always', 'not fair'], phrase: 'â€œYou secretly wonder: Do mom and dad like them more?â€' },
            { emoji: 'ğŸ˜', text: 'Feels less important than their sibling', keywords: ['donâ€™t love me', 'like them more', 'always'], phrase: 'â€œYouâ€™re scared you might be the less-loved kid, so youâ€™re extra sensitive.â€' }
          ],
          needs: [
            { emoji: 'âš–ï¸', text: 'To feel theyâ€™re treated fairly', keywords: ['fair', 'same', 'why'], phrase: 'Doesnâ€™t have to be exactly equal every time, but they need to feel considered.' },
            { emoji: 'ğŸ‘ï¸', text: 'To have their side of the story heard', keywords: ['they started', 'but', 'I'], phrase: 'A chance to explain without always being told to â€œjust be the bigger oneâ€.' },
            { emoji: 'ğŸ¯', text: 'To learn how to take turns or work things out', keywords: ['my turn', 'take turns', 'together'], phrase: 'Tools for â€œhow to shareâ€ instead of only â€œdonâ€™t fightâ€.' }
          ],
          responses: [
            { main: 'Say out loud both kidsâ€™ feelings first.', say: 'â€œYouâ€™re really mad it got taken away; and you feel upset because you never get a turn.â€' },
            { main: 'Describe what happened before deciding whoâ€™s right.', say: 'â€œThe toy was in your hands first, then it got taken without asking.â€' },
            { main: 'Brainstorm turn-taking or playing together.', say: 'â€œDo you want to take turns, or build something together? Letâ€™s try a couple of ideas.â€' }
          ]
        },
        school: {
          emotions: [
            { emoji: 'ğŸ˜¤', text: 'Thinks their sibling is annoying or childish', keywords: ['annoying', 'babyish', 'hate', 'loud'], phrase: 'â€œYou feel like theyâ€™re always bugging you when you just want to do your own thing.â€' },
            { emoji: 'ğŸ˜’', text: 'Feels youâ€™re biased or unfair', keywords: ['favour', 'always me', 'why me', 'unfair'], phrase: 'â€œYouâ€™re thinking: Whenever something happens, Iâ€™m the one who gets blamed.â€' },
            { emoji: 'ğŸ˜”', text: 'Feels their space and things get invaded', keywords: ['mine', 'room', 'stuff', 'privacy'], phrase: 'â€œYou have your own space and things, and when people barge in or touch them, it feels really bad.â€' }
          ],
          needs: [
            { emoji: 'ğŸšª', text: 'Personal space and privacy', keywords: ['room', 'privacy', 'donâ€™t come in', 'space'], phrase: 'A few things / areas that are â€œjust mineâ€ really matter at this age.' },
            { emoji: 'ğŸ‘‚', text: 'A chance to vent about how annoying it feels', keywords: ['always', 'annoying', 'bother'], phrase: 'Not just â€œYouâ€™re older, deal with it,â€ but real listening.' },
            { emoji: 'âš–ï¸', text: 'Fair rules (older kid doesnâ€™t always have to give in)', keywords: ['why me', 'I always', 'they never'], phrase: 'Understanding that â€œfairâ€ doesnâ€™t mean â€œthe older one always has to sacrificeâ€.' }
          ],
          responses: [
            { main: 'Talk with them alone and admit it really is frustrating.', say: 'â€œLittle siblings barging in is actually pretty annoying, huh? Tell me what bugs you the most.â€' },
            { main: 'Create some basic rules about space and belongings together.', say: 'â€œLetâ€™s set some rules: knock before going into your room, and ask before using each otherâ€™s things.â€' },
            { main: 'Donâ€™t force â€œbeing niceâ€, just insist on respectful behaviour.', say: 'â€œItâ€™s your choice whether or not to share your stuff. Whatâ€™s not okay is yelling or name-calling.â€' }
          ]
        }
      }
    },
    bedtime: {
      name: 'Refusing bedtime',
      icon: 'ğŸŒ™',
      ageVariants: {
        toddler: {
          emotions: [
            { emoji: 'ğŸ˜£', text: 'Doesnâ€™t want the fun to stop', keywords: ['more', 'again', 'play', 'no'], phrase: 'â€œYou were having so much fun, and suddenly youâ€™re told to stop. Of course you donâ€™t like that.â€' },
            { emoji: 'ğŸ˜¨', text: 'Feels a bit scared of the dark', keywords: ['dark', 'light', 'stay', 'alone'], phrase: 'â€œWhen the lights go off and it gets quiet, it feels a bit scary.â€' },
            { emoji: 'ğŸ˜«', text: 'Too wound up, brain canâ€™t slow down', keywords: ['donâ€™t want to sleep', 'not tired', 'not sleepy'], phrase: 'â€œYour body is tired, but your brain is still running fast.â€' }
          ],
          needs: [
            { emoji: 'ğŸ”„', text: 'A predictable bedtime routine', keywords: ['when', 'bedtime', 'routine'], phrase: 'The same simple steps every night so their brain knows â€œsleep is comingâ€.' },
            { emoji: 'ğŸ’—', text: 'Soothing and close contact', keywords: ['stay', 'with me', 'hug'], phrase: 'Someone nearby so their body can relax more easily.' },
            { emoji: 'ğŸŒ™', text: 'A calmer, dimmer environment', keywords: ['light', 'noise', 'bright'], phrase: 'Lights and sounds down first, then the feelings can settle.' }
          ],
          responses: [
            { main: 'Create a simple, repeatable bedtime ritual.', say: 'â€œEvery night we do this: bath, brush teeth, one story, big hug, then lights out.â€' },
            { main: 'Lessen the fear of darkness by staying close at first.', say: 'â€œIâ€™ll lie next to you until you fall asleep, then Iâ€™ll go to the living room. When you wake up, Iâ€™ll be here again.â€' },
            { main: 'Tweak the room lighting and background noise.', say: 'â€œWeâ€™ll leave a small night light on and play soft music so you can feel safer.â€' }
          ]
        },
        preschool: {
          emotions: [
            { emoji: 'ğŸ˜£', text: 'Hates stopping playtime', keywords: ['keep playing', 'one more', 'play', 'donâ€™t want'], phrase: 'â€œYou think: Just a bit more, please! Itâ€™s so hard to stop when youâ€™re having fun.â€' },
            { emoji: 'ğŸ˜´', text: 'Thinks sleep is boring compared to fun stuff', keywords: ['donâ€™t want to sleep', 'boring', 'still want'], phrase: 'â€œCompared to toys or stories, going to bed feels really boring.â€' },
            { emoji: 'ğŸ˜¨', text: 'Worried about the dark or bad dreams', keywords: ['dark', 'nightmare', 'dream', 'scared'], phrase: 'â€œSometimes you have weird or scary dreams, so closing your eyes feels a bit scary.â€' }
          ],
          needs: [
            { emoji: 'ğŸ”„', text: 'A routine that clearly signals â€œthis is the end of the dayâ€', keywords: ['routine', 'order', 'every day'], phrase: 'A steady bedtime flow helps the brain switch from â€œplay modeâ€ to â€œrest modeâ€.' },
            { emoji: 'ğŸ’—', text: 'Some special 1:1 time before sleep', keywords: ['stay', 'talk', 'chat'], phrase: 'A short slice of time where the adult is just with them.' },
            { emoji: 'ğŸ›¡ï¸', text: 'Reassurance that youâ€™re still around while they sleep', keywords: ['where will you be', 'will you', 'are you'], phrase: 'Knowing where youâ€™ll be once they fall asleep reduces anxiety.' }
          ],
          responses: [
            { main: 'Acknowledge that stopping is hard when theyâ€™re into something.', say: 'â€œYou were really into your game, so of course it feels bad to stop and go to bed.â€' },
            { main: 'Keep a consistent â€œwind downâ€ routine.', say: 'â€œWeâ€™ll brush your teeth, pick one story, read it, then lights out and a goodnight hug.â€' },
            { main: 'Be clear about where youâ€™ll be.', say: 'â€œWhen youâ€™re sleeping, Iâ€™ll be in the living room. When you wake up in the morning, youâ€™ll see me right away.â€' }
          ]
        },
        school: {
          emotions: [
            { emoji: 'ğŸ˜¤', text: 'Feels not tired and doesnâ€™t like being told what to do', keywords: ['not tired', 'donâ€™t want to sleep', 'still', 'no'], phrase: 'â€œYou think: Iâ€™m not even sleepy yet, why are you controlling me?â€' },
            { emoji: 'ğŸ“±', text: 'Wants more screen time or to keep reading / doing something', keywords: ['phone', 'book', 'watch', 'tablet'], phrase: 'â€œYour mind is still inside the show, game, or story, so itâ€™s hard to shut it off.â€' },
            { emoji: 'ğŸ˜Ÿ', text: 'Lies in bed and starts overthinking', keywords: ['canâ€™t sleep', 'keep thinking', 'worried'], phrase: 'â€œOnce you lie down, your brain starts spinning with all sorts of thoughts.â€' }
          ],
          needs: [
            { emoji: 'â°', text: 'A negotiated bedtime they can accept', keywords: ['what time', 'too early', 'late'], phrase: 'A rough time window that feels somewhat fair to both of you.' },
            { emoji: 'ğŸ“µ', text: 'No screens for about an hour before bed', keywords: ['phone', 'tablet', 'screen'], phrase: 'Some non-screen wind-down so their brain can slow itself down.' },
            { emoji: 'ğŸ’­', text: 'Space to talk through worries if anxiety shows up at night', keywords: ['worried', 'scared', 'tomorrow', 'stress'], phrase: 'Someone willing to hear â€œwhatâ€™s spinning in your headâ€ before sleep.' }
          ],
          responses: [
            { main: 'Collaborate on a reasonable bedtime.', say: 'â€œYouâ€™ve got to wake up early tomorrow. Iâ€™m thinking lights out around 9:30 â€” how does that sound? We can adjust a bit together.â€' },
            { main: 'Set a family rule about screen-free time before bed.', say: 'â€œAfter 9pm, phones stay in the living room. You can read or draw instead.â€' },
            { main: 'Create a tiny â€œworry timeâ€ before sleep.', say: 'â€œWhen you lie down, what does your brain keep thinking about? Want to spend 5 minutes talking it out with me?â€' }
          ]
        }
      }
    },
    transition: {
      name: 'Doesnâ€™t want to clean up / transition',
      icon: 'â±ï¸',
      ageVariants: {
        toddler: {
          emotions: [
            { emoji: 'ğŸ˜¤', text: 'Gets mad when interrupted', keywords: ['more', 'no', 'still playing'], phrase: 'â€œYouâ€™re right in the middle of something, and being told to stop makes you mad.â€' },
            { emoji: 'ğŸ˜«', text: 'Feels cleaning is boring and tiring', keywords: ['donâ€™t want', 'tired', 'no'], phrase: 'â€œCleaning up feels like a lot of work and not fun at all.â€' },
            { emoji: 'ğŸ˜•', text: 'Doesnâ€™t know how or where to start', keywords: ['donâ€™t know', 'how', 'where'], phrase: 'â€œYouâ€™re not sure where things go, so you just stall.â€' }
          ],
          needs: [
            { emoji: 'ğŸ¯', text: 'An adult to show them how to clean up', keywords: ['how', 'where', 'put'], phrase: 'Someone to point: â€œThis goes here, that goes there.â€' },
            { emoji: 'ğŸ‘', text: 'You cleaning together with them', keywords: ['help', 'together', 'stay'], phrase: 'At this age, â€œletâ€™s do it togetherâ€ works better than â€œgo do it aloneâ€.' },
            { emoji: 'ğŸµ', text: 'Turning cleanup into a little game', keywords: ['play', 'game', 'song'], phrase: 'Songs, timers, or playful challenges help a lot.' }
          ],
          responses: [
            { main: 'Use â€œweâ€ instead of â€œyou go do itâ€.', say: 'â€œLetâ€™s clean up together. You pick up the red blocks, Iâ€™ll grab the blue ones. Letâ€™s see whoâ€™s faster.â€' },
            { main: 'Make cleanup a quick game.', say: 'â€œWeâ€™ll sing the clean-up song, and when the song ends, letâ€™s see how much weâ€™ve cleared.â€' },
            { main: 'Give very specific instructions.', say: 'â€œBlocks go in this box, cars go in that basket.â€' }
          ]
        },
        preschool: {
          emotions: [
            { emoji: 'ğŸ˜¤', text: 'Annoyed at being suddenly cut off', keywords: ['still playing', 'wait', 'suddenly', 'more'], phrase: 'â€œYou were focused on your play, and being told to stop feels annoying.â€' },
            { emoji: 'ğŸ˜‘', text: 'Feels they have no choice in the matter', keywords: ['why', 'donâ€™t want', 'have to'], phrase: 'â€œYou feel like everything is decided for you and you never get a say.â€' },
            { emoji: 'ğŸ˜°', text: 'Feels pressured when rushed to clean up', keywords: ['hurry', 'quick', 'faster', 'keep saying'], phrase: 'â€œBeing told â€˜Hurry up!â€™ over and over makes your body tense and stuck.â€' }
          ],
          needs: [
            { emoji: 'â°', text: 'A little warning before transitions', keywords: ['suddenly', 'right now', 'wait'], phrase: 'A 5-minute heads-up before clean-up time.' },
            { emoji: 'ğŸ›ï¸', text: 'Some sense of choice and control', keywords: ['I want', 'can I', 'choose'], phrase: 'They can choose what to start with or who cleans up what.' },
            { emoji: 'ğŸ“‹', text: 'Breaking the task into smaller steps', keywords: ['how', 'donâ€™t know', 'too much'], phrase: 'Smaller chunks make it feel less overwhelming.' }
          ],
          responses: [
            { main: 'Give a simple heads-up instead of a sudden command.', say: 'â€œYou can play for 5 more minutes. When the timer rings, weâ€™ll clean up together.â€' },
            { main: 'Break it down into one step at a time.', say: 'â€œFirst, letâ€™s put the blocks back in their box. After that, weâ€™ll tackle the toy cars on the floor, okay?â€' },
            { main: 'Notice their focus and frustration.', say: 'â€œYou were really into building that, so of course being told to stop feels frustrating.â€' }
          ]
        },
        school: {
          emotions: [
            { emoji: 'ğŸ˜¤', text: 'Feels nagged all the time', keywords: ['I know', 'so annoying', 'always', 'nag'], phrase: 'â€œYou think: I heard you the first time, why do you keep repeating it?â€' },
            { emoji: 'ğŸ˜‘', text: 'Thinks â€œWhy is it always my job?â€', keywords: ['why me', 'my brother', 'my sister', 'I have to'], phrase: 'â€œYou feel like everyone uses the stuff, but youâ€™re the only one being told to clean.â€' },
            { emoji: 'ğŸ“±', text: 'Wants to finish what theyâ€™re doing first', keywords: ['wait', 'after this', 'let me finish'], phrase: 'â€œYour mind is still on your show/game/homework, not on cleaning up yet.â€' }
          ],
          needs: [
            { emoji: 'â°', text: 'A chance to plan their own cleanup time', keywords: ['later', 'what time', 'I know', 'I will'], phrase: 'Some say in â€œwhat time before Xâ€ theyâ€™ll do it.' },
            { emoji: 'âš–ï¸', text: 'Clear and fair division of chores', keywords: ['why only me', 'they never', 'fair'], phrase: 'Understanding that everyone has responsibilities, not just them.' },
            { emoji: 'ğŸ¯', text: 'To understand why cleaning matters', keywords: ['why', 'not necessary', 'have to'], phrase: 'Not only â€œbecause I said soâ€, but real reasons like safety and finding things.' }
          ],
          responses: [
            { main: 'Offer a time window instead of â€œright now or elseâ€.', say: 'â€œAs long as itâ€™s done before dinner, itâ€™s okay. Do you want to do it now, or at 6 oâ€™clock?â€' },
            { main: 'Explain the â€œwhyâ€ behind cleaning.', say: 'â€œIf things are put away, nobody trips and gets hurt, and next time you can find your stuff faster.â€' },
            { main: 'Talk through the familyâ€™s division of chores.', say: 'â€œHow do you think we should divide jobs fairly at home? Letâ€™s lay it out together.â€' }
          ]
        }
      }
    },
    mealtime: {
      name: 'Mealtime battles',
      icon: 'ğŸ½ï¸',
      ageVariants: {
        toddler: {
          emotions: [
            { emoji: 'ğŸ˜', text: 'Not very interested in the food', keywords: ['no eat', 'donâ€™t want', 'no food'], phrase: 'â€œThe food on the table just doesnâ€™t look that exciting to you.â€' },
            { emoji: 'ğŸ˜', text: 'Playing with food is more fun than eating it', keywords: ['play', 'throw', 'mess'], phrase: 'â€œItâ€™s more fun to play with your food than to put it in your tummy.â€' },
            { emoji: 'ğŸ˜£', text: 'Maybe not hungry, or full from snacks', keywords: ['not hungry', 'full', 'snack'], phrase: 'â€œYou might already feel kind of full, so youâ€™re not that into eating right now.â€' }
          ],
          needs: [
            { emoji: 'ğŸ¼', text: 'Possibly fewer snacks before meals', keywords: ['snack', 'cookie', 'cracker', 'eat'], phrase: 'Take a look at how many snacks theyâ€™ve had before expecting a big meal.' },
            { emoji: 'ğŸ®', text: 'A less distracting eating environment', keywords: ['TV', 'toy', 'phone'], phrase: 'Fewer distractions makes it easier to focus on eating.' },
            { emoji: 'â°', text: 'Somewhat regular meal times', keywords: ['time', 'when', 'clock'], phrase: 'Roughly fixed mealtimes help their body learn the rhythm.' }
          ],
          responses: [
            { main: 'First, check if snacks have filled them up.', say: 'â€œDid you have some crackers just now? That might be why you donâ€™t feel hungry.â€' },
            { main: 'Turn off or put away distractions.', say: 'â€œDuring meals, the toys and TV can rest. When weâ€™re done, we can play again.â€' },
            { main: 'Set a calm but clear time limit for meals.', say: 'â€œWeâ€™ll sit and eat for about 20 minutes. After that, weâ€™ll clear the table, and if youâ€™re hungry later, you can wait for the next meal.â€' }
          ]
        },
        preschool: {
          emotions: [
            { emoji: 'ğŸ˜', text: 'Not into certain foods / not very hungry', keywords: ['donâ€™t want to eat', 'yucky', 'not hungry'], phrase: 'â€œSome of these foods just donâ€™t look that appealing to you.â€' },
            { emoji: 'ğŸ˜', text: 'Would rather keep playing or watching something', keywords: ['play', 'watch', 'want to', 'do'], phrase: 'â€œYouâ€™d much rather get back to playing or watching than sit and eat.â€' },
            { emoji: 'ğŸ˜£', text: 'Feels pressured by constant reminders', keywords: ['hurry', 'faster', 'come on'], phrase: 'â€œHearing â€˜Come on, hurry upâ€™ again and again makes you want to eat even less.â€' }
          ],
          needs: [
            { emoji: 'ğŸ®', text: 'A mealtime thatâ€™s mostly about eating, not multitasking', keywords: ['TV', 'toy', 'distracted'], phrase: 'Keeping screens and toys away during meals helps them tune in to their body.' },
            { emoji: 'â±ï¸', text: 'A reasonable amount of time to eat', keywords: ['too long', 'sit', 'forever'], phrase: 'Not sitting forever, but enough time to actually eat.' },
            { emoji: 'ğŸ´', text: 'Respect for â€œIâ€™m fullâ€ cues', keywords: ['full', 'canâ€™t eat', 'not hungry'], phrase: 'Being allowed to say â€œIâ€™m fullâ€ and be believed, within reason.' }
          ],
          responses: [
            { main: 'Describe what you notice instead of blaming.', say: 'â€œI notice youâ€™re eating really slowly. Are you not very hungry, or not really liking this dish?â€' },
            { main: 'Adjust portions to set them up for success.', say: 'â€œThis might be too much for you. Letâ€™s start with a smaller amount â€” it feels good to finish whatâ€™s on the plate.â€' },
            { main: 'Have a calm, consistent rule about mealtime.', say: 'â€œWeâ€™ll sit at the table and focus on eating for about 20 minutes. After that weâ€™ll clean up, whether the plate is finished or not.â€' }
          ]
        },
        school: {
          emotions: [
            { emoji: 'ğŸ˜', text: 'Really dislikes certain foods', keywords: ['hate', 'donâ€™t like', 'gross'], phrase: 'â€œYou honestly donâ€™t like some of these foods, not just being picky on purpose.â€' },
            { emoji: 'ğŸ“±', text: 'Wants to eat with a screen or entertainment', keywords: ['phone', 'video', 'watch', 'tablet'], phrase: 'â€œEating without a screen feels boring to you.â€' },
            { emoji: 'ğŸ˜¤', text: 'Feels forced or controlled around eating', keywords: ['have to', 'force', 'make me'], phrase: 'â€œYou feel like: Why are you forcing me to finish everything?â€' }
          ],
          needs: [
            { emoji: 'ğŸ—£ï¸', text: 'A say in what meals are like sometimes', keywords: ['donâ€™t like', 'I want', 'choose'], phrase: 'A chance to share preferences and help plan meals.' },
            { emoji: 'âš–ï¸', text: 'To understand nutrition in a simple way', keywords: ['why', 'healthy', 'unhealthy'], phrase: 'Knowing what different foods do for their body.' },
            { emoji: 'ğŸ“µ', text: 'Mealtimes that feel like family time, not performance time', keywords: ['eat together', 'talk', 'family'], phrase: 'Feeling like meals are for connection, not just â€œeat and be judgedâ€.' }
          ],
          responses: [
            { main: 'Invite them to help plan some meals for the week.', say: 'â€œWhat are a few things youâ€™d love to eat this week? Letâ€™s add them into our plan.â€' },
            { main: 'Explain nutrition in a non-scary, non-shaming way.', say: 'â€œYour body needs a bit of everything â€” some veggies, some protein, some carbs â€” so it has enough power for the day.â€' },
            { main: 'Make meals a time to connect, not just monitor.', say: 'â€œDuring meals, letâ€™s put our phones aside and just eat and talk about our day.â€' }
          ]
        }
      }
    },
    other: {
      name: 'Hard to describe, just a rough day',
      icon: 'ğŸ˜µ',
      ageVariants: {
        toddler: {
          emotions: [
            { emoji: 'ğŸ˜«', text: 'Lots of little things felt â€œoffâ€ today', keywords: [], phrase: 'â€œSo many things didnâ€™t go your way today, and crying or yelling is how your body lets it out.â€' },
            { emoji: 'ğŸ˜µ', text: 'Too many sounds, people, or changes', keywords: [], phrase: 'â€œThere were just too many people, noises, and things going on. It all felt like too much.â€' },
            { emoji: 'ğŸ˜¢', text: 'Feels bad but has no words for it', keywords: [], phrase: 'â€œYou just know you feel bad inside, but you donâ€™t know how to say it with words yet.â€' }
          ],
          needs: [
            { emoji: 'ğŸ‘', text: 'A safe place where itâ€™s okay to fall apart', keywords: [], phrase: 'A grown-up who can stay nearby while they cry, without expecting â€œgood behaviourâ€ right away.' },
            { emoji: 'ğŸ’—', text: 'To hear â€œyour big feelings are allowed hereâ€', keywords: [], phrase: 'Knowing that their sadness or anger wonâ€™t make you leave.' },
            { emoji: 'â¸ï¸', text: 'A slower pace and fewer demands for the rest of the day', keywords: [], phrase: 'Less doing, more resting, so their nervous system can reset a bit.' }
          ],
          responses: [
            { main: 'Offer a safe space to fall apart.', say: 'â€œToday was really a lot for you. Iâ€™m here with you. Itâ€™s okay to cry or be mad â€” Iâ€™ll stay.â€' },
            { main: 'Normalize their meltdown instead of shaming it.', say: 'â€œYouâ€™re crying so hard because today was just really hard. Itâ€™s okay. I see how tired you are.â€' },
            { main: 'Lower expectations for the rest of the day.', say: 'â€œLetâ€™s keep the rest of today simple and quiet. We can talk about other stuff another day.â€' }
          ]
        },
        preschool: {
          emotions: [
            { emoji: 'ğŸ˜©', text: 'Feels like the whole day has been tiring and annoying', keywords: [], phrase: 'â€œYouâ€™re thinking: Everything today has been kind of awful.â€' },
            { emoji: 'ğŸ˜¢', text: 'A lot of little hurts piling up', keywords: [], phrase: 'â€œMaybe lots of small disappointments have stacked up inside.â€' },
            { emoji: 'ğŸ˜¤', text: 'Doesnâ€™t know how to explain, so it comes out as yelling', keywords: [], phrase: 'â€œYou donâ€™t know what to say, so it all comes out as shouting or crying.â€' }
          ],
          needs: [
            { emoji: 'ğŸ‘‚', text: 'A pair of ears that just listen, without jumping in to correct', keywords: [], phrase: 'Someone who can listen first, not immediately judge or fix.' },
            { emoji: 'ğŸ¤—', text: 'Some extra hugs and comfort', keywords: [], phrase: 'Being held or gently touched can be very regulating.' },
            { emoji: 'ğŸ§¸', text: 'A soft â€œjust for meâ€ time', keywords: [], phrase: 'A small pocket of time where you do something gentle together that they choose.' }
          ],
          responses: [
            { main: 'Acknowledge that today was hard for both of you.', say: 'â€œI think today has been really tiring for you too. So many things happened, so now even a small thing can feel huge.â€' },
            { main: 'Make â€œIâ€™ll just listenâ€ your main goal today.', say: 'â€œTell me one thing that made you the most mad or sad today. Iâ€™ll just listen and wonâ€™t scold you.â€' },
            { main: 'Offer a small slice of one-on-one time.', say: 'â€œLetâ€™s have 10 minutes that are just you and me, doing something you choose. Everything else can wait.â€' }
          ]
        },
        school: {
          emotions: [
            { emoji: 'ğŸ˜µ', text: 'Feels completely overloaded, like today was just too much', keywords: [], phrase: 'â€œYou might feel like today was just really hard to survive.â€' },
            { emoji: 'ğŸ˜”', text: 'Has things they donâ€™t want to talk about yet', keywords: [], phrase: 'â€œThere are things you donâ€™t really want to talk about, so you just carry them around inside.â€' },
            { emoji: 'ğŸ˜¤', text: 'Wants to be understood but expects a lecture if they open up', keywords: [], phrase: 'â€œYouâ€™d like to be understood, but youâ€™re scared that if you talk, youâ€™ll just get a lecture.â€' }
          ],
          needs: [
            { emoji: 'ğŸ›Ÿ', text: 'Someone to say â€œI see that youâ€™re having a hard timeâ€', keywords: [], phrase: 'To hear that their struggle is noticed, not minimized.' },
            { emoji: 'ğŸ•°ï¸', text: 'Some alone time / downtime after a hard day', keywords: [], phrase: 'Not being grilled about homework or chores the second they walk in.' },
            { emoji: 'ğŸ‘‚', text: 'A space to talk without being judged or â€œfixedâ€ right away', keywords: [], phrase: 'A conversation where their feelings are allowed, even if you donâ€™t agree with every detail.' }
          ],
          responses: [
            { main: 'Say out loud that today seems really hard for them.', say: 'â€œLooks like today has been pretty rough for you. Iâ€™m guessing youâ€™re wiped out inside.â€' },
            { main: 'Offer some quiet time before expecting anything else.', say: 'â€œDo you want some time alone first? When youâ€™re ready, you can come find me â€” Iâ€™ll be here.â€' },
            { main: 'Promise a no-lecture conversation.', say: 'â€œIf you ever feel like venting about today, I can just listen without giving a speech. We can do that if you want.â€' }
          ]
        }
      }
    }
  };

  // === Encouragement messages for parents ===
  const encouragementMessages = {
    raiseVoice: 'The fact that youâ€™re willing to write this down means you really care about the relationship. Most parents raise their voice when theyâ€™re tired and overwhelmed â€” youâ€™re far from alone. Next time, you could experiment with taking 3 slow breaths before saying the first sentence.',
    threaten: 'Those â€œIf you donâ€™tâ€¦, Iâ€™llâ€¦â€ threats usually pop out when we feel desperate and powerless. Seeing this in yourself already means something in you wants to do it differently.',
    giveUp: 'When you give in, itâ€™s often because youâ€™ve hit your limit, not because youâ€™re a bad parent. It just means you also need rest and support â€” youâ€™re human, not a machine.',
    cold: 'Pulling away or going cold usually means your own feelings are overflowing too. The courage to come back later and look at it like youâ€™re doing now is a big deal. Next time you might try, â€œI need a few minutes to calm down, then Iâ€™ll come talk to you.â€',
    compare: 'Comparing kids is often the language many of us grew up hearing, so it slips out easily. The moment you notice â€œI donâ€™t actually want to parent like thisâ€, thatâ€™s already the starting line of change.',
    label: 'Labels tend to jump out when weâ€™re at our edge and words just spill out. Being honest enough to tick this box shows a lot of self-awareness and bravery.',
    tiredBlank: 'When you choose â€œI was exhausted and my brain went blankâ€, youâ€™re admitting something important: youâ€™re also a person with limits. That isnâ€™t selfish â€” itâ€™s honest, and it matters.',

    empathy: 'You tried to name your childâ€™s feelings first. That is a powerful skill. For your child, a simple â€œYouâ€™re really upset, huh?â€ can stay with them for a long time.',
    boundary: 'You managed a kind but firm boundary â€” thatâ€™s much harder than either â€œgive inâ€ or â€œjust be strictâ€. Your child can grow real safety inside these sorts of boundaries.',
    repair: 'You went back to repair after things went sideways. For a child, this teaches â€œwe can make up after a ruptureâ€ â€” often more valuable than a parent who never loses their temper.',

    mixed: 'Youâ€™re seeing both â€œthe parts that hurtâ€ and â€œthe parts you did wellâ€. Holding both honestly and kindly is a very mature way to parent.',
    allPositive: 'From todayâ€™s answers, itâ€™s clear youâ€™re already practising a more connected, boundary-based way of parenting. It may still feel tiring, but your relationship is being tended to, bit by bit.',
    allNegative: 'Today might have been especially tough. No parent is endlessly calm and patient. The fact that youâ€™re still here, reflecting and recording, says you havenâ€™t given up on this relationship.',
    noSelection: 'Even if youâ€™re not sure yet how you reacted, just clicking into this tool and being willing to look at yourself and your child is already a quiet but meaningful shift.'
  };

  let currentAge = 'toddler';
  let currentScenario = null;
  let selectedReactions = new Set();
  let selectedResponses = new Set();
  let currentAnalysis = null;
  let records = [];

  // === Storage helpers ===
  function initRecords() {
    try {
      const saved = localStorage.getItem('parentingRecords');
      if (saved) {
        records = JSON.parse(saved);
      }
    } catch (e) {
      console.error('Failed to load records:', e);
      records = [];
    }
  }

  function saveRecords() {
    try {
      localStorage.setItem('parentingRecords', JSON.stringify(records));
    } catch (e) {
      console.error('Failed to save records:', e);
    }
  }

  // === Age selection ===
  function selectAge(age, element) {
    document.querySelectorAll('.age-button').forEach(b => b.classList.remove('active'));
    element.classList.add('active');
    currentAge = age;
  }

  // === Scenario selection ===
  function selectScenario(scenario, element) {
    document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('active'));
    element.classList.add('active');
    currentScenario = scenario;
  }

  // === Reaction selection ===
  function toggleReaction(reaction, element, event) {
    const checkbox = element.querySelector('input[type="checkbox"]');
    if (event && event.target !== checkbox) {
      checkbox.checked = !checkbox.checked;
    }
    if (checkbox.checked) {
      element.classList.add('selected');
      selectedReactions.add(reaction);
    } else {
      element.classList.remove('selected');
      selectedReactions.delete(reaction);
    }
  }

  function toggleResponseSelection(index, checkbox, event) {
    if (event && event.target !== checkbox) {
      checkbox.checked = !checkbox.checked;
    }
    if (checkbox.checked) {
      selectedResponses.add(index);
    } else {
      selectedResponses.delete(index);
    }
  }

  // === Tab switching ===
  function switchTab(name) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));

    const tabs = { translate: 0, note: 1, history: 2 };
    const tabContents = ['translateTab', 'noteTab', 'historyTab'];
    
    document.getElementById(tabContents[tabs[name]]).classList.add('active');
    document.querySelectorAll('.tab-button')[tabs[name]].classList.add('active');

    if (name === 'history') {
      displayHistory();
    }
  }

  // === Step navigation ===
  function showStep1() {
    document.getElementById('step1').classList.remove('hidden');
    document.getElementById('step2').classList.add('hidden');
    document.getElementById('step3').classList.add('hidden');
    updateStepIndicator(1);
  }

  function showStep2() {
    if (!currentScenario) {
      alert('Please pick a situation first (just choose the one that feels closest).');
      return;
    }
    analyzeAndDisplay();
    document.getElementById('step1').classList.add('hidden');
    document.getElementById('step2').classList.remove('hidden');
    document.getElementById('step3').classList.add('hidden');
    updateStepIndicator(2);
  }

  function showStep3() {
    selectedReactions.clear();
    document.querySelectorAll('.reaction-card').forEach(card => {
      card.classList.remove('selected');
      const cb = card.querySelector('input[type="checkbox"]');
      if (cb) cb.checked = false;
    });
    
    document.getElementById('step1').classList.add('hidden');
    document.getElementById('step2').classList.add('hidden');
    document.getElementById('step3').classList.remove('hidden');
    updateStepIndicator(3);
  }

  function updateStepIndicator(step) {
    for (let i = 1; i <= 3; i++) {
      const dot = document.getElementById(`stepDot${i}`);
      if (i === step) {
        dot.classList.add('active');
      } else {
        dot.classList.remove('active');
      }
    }
  }

  // === Analysis based on age + scenario + user text ===
  function analyzeAndDisplay() {
    const template = scenarioTemplates[currentScenario];
    const ageData = template.ageVariants[currentAge];
    const userText = document.getElementById('scenarioText').value.trim().toLowerCase();

    let emotions = [...ageData.emotions];
    emotions.forEach(e => {
      let score = 0;
      e.keywords.forEach(k => {
        if (userText.includes(k.toLowerCase())) {
          score += 2;
        }
      });
      e.relevance = score > 0 ? score : 1;
    });
    emotions.sort((a, b) => b.relevance - a.relevance);
    emotions = emotions.slice(0, 3);

    let needs = [...ageData.needs];
    needs.forEach(n => {
      let score = 0;
      n.keywords.forEach(k => {
        if (userText.includes(k.toLowerCase())) {
          score += 2;
        }
      });
      n.relevance = score > 0 ? score : 1;
    });
    needs.sort((a, b) => b.relevance - a.relevance);
    needs = needs.slice(0, 3);

    const responses = [...ageData.responses];

    currentAnalysis = { emotions, needs, responses, userText };
    selectedResponses.clear();
    displayAnalysis();
  }

  function displayAnalysis() {
    const { emotions, needs, responses } = currentAnalysis;
    
    const emotionHTML = emotions
      .map(e => `
        <div class="emotion-badge">
          <span class="emotion-emoji">${e.emoji}</span>${e.text}
          <div class="emotion-phrase">ğŸ‘‰ You could say: ${e.phrase}</div>
        </div>
      `)
      .join('');
    document.getElementById('emotionItems').innerHTML = emotionHTML;

    const needHTML = needs
      .map(n => `
        <div class="need-badge">
          <span class="emotion-emoji">${n.emoji}</span>${n.text}
          <div class="need-phrase">ğŸ’¡ Key idea: ${n.phrase}</div>
        </div>
      `)
      .join('');
    document.getElementById('needItems').innerHTML = needHTML;

    const responseHTML = responses
      .map((r, i) => `
        <div class="response-item">
          <span class="response-number">${i+1}</span>
          <span class="response-main">${r.main}</span>
          <div class="response-say">
            ğŸ‘‰ Possible wording: <strong>â€œ${r.say.replace(/^â€œ|â€$/g, '').replace(/^"|"$/g, '')}â€</strong>
          </div>
          <label class="response-select" onclick="toggleResponseSelection(${i}, this.querySelector('input'), event)">
            <input type="checkbox" onchange="toggleResponseSelection(${i}, this, event)"> Iâ€™d like to try this one
          </label>
        </div>
      `)
      .join('');
    document.getElementById('responseItems').innerHTML = responseHTML;
  }

  // === Encouragement block ===
  function generateEncouragement() {
    const reactions = Array.from(selectedReactions);
    
    if (reactions.length === 0) {
      return {
        emoji: 'ğŸ’ª',
        highlight: 'Just showing up here and filling this out is already caring for your relationship.',
        message: encouragementMessages.noSelection
      };
    }

    const negativeReactions = ['raiseVoice', 'threaten', 'giveUp', 'cold', 'compare', 'label'];
    const positiveReactions = ['empathy', 'boundary', 'repair'];
    
    const negativeCount = reactions.filter(r => negativeReactions.includes(r)).length;
    const positiveCount = reactions.filter(r => positiveReactions.includes(r)).length;

    let messages = [];

    reactions.forEach(r => {
      if (encouragementMessages[r]) {
        messages.push(encouragementMessages[r]);
      }
    });

    let highlight = '';
    if (positiveCount > 0 && negativeCount === 0) {
      messages.push(encouragementMessages.allPositive);
      highlight = 'You actually did quite a few things that help the relationship grow.';
    } else if (negativeCount > 0 && positiveCount === 0) {
      messages.push(encouragementMessages.allNegative);
      highlight = 'Today was hard, and you still care enough to look back at it.';
    } else if (positiveCount > 0 && negativeCount > 0) {
      messages.push(encouragementMessages.mixed);
      highlight = 'Youâ€™re seeing both your rough edges and your efforts â€” thatâ€™s real growth.';
    }

    const selectedMessages = messages.slice(0, 2).join('\n\n');

    return {
      emoji: positiveCount >= negativeCount ? 'ğŸŒŸ' : 'ğŸ’ª',
      highlight: highlight || 'Youâ€™re quietly shifting how you show up with your child.',
      message: selectedMessages
    };
  }

  // === Note generation + saving ===
  function goToNote() {
    if (!currentScenario || !currentAnalysis) {
      alert('Please finish the first 2 steps of the translation before viewing the note.');
      return;
    }
    
    generateNote();
    switchTab('note');
  }

  function generateNote() {
    if (!currentScenario || !currentAnalysis) {
      document.getElementById('noteBox').innerHTML = '<span class="note-placeholder">Please complete the 3 steps on the left first.</span>';
      document.getElementById('encouragementSection').innerHTML = '';
      return;
    }

    const template = scenarioTemplates[currentScenario];
    const text = document.getElementById('scenarioText').value.trim();
    const { emotions, needs, responses } = currentAnalysis;

    const ageNames = {
      toddler: '1â€“3 years old',
      preschool: '3â€“6 years old',
      school: '6â€“12 years old'
    };

    const reactionMap = {
      raiseVoice: 'My feelings got big and I raised my voice',
      threaten: 'I used â€œIf youâ€¦, then Iâ€™llâ€¦â€ type threats',
      giveUp: 'I ended up giving in / dropping my boundary',
      cold: 'I pulled back or went â€œcoldâ€ for a while',
      compare: 'I compared my child to someone else',
      label: 'I used labels (â€œYouâ€™re soâ€¦â€, â€œYou alwaysâ€¦â€)',
      empathy: 'I tried to name their feelings first',
      boundary: 'I set a kind but firm boundary',
      repair: 'I tried to reconnect or repair afterwards',
      tiredBlank: 'I was really tired and my brain went blank'
    };

    const myReactions = Array.from(selectedReactions)
      .map(r => 'ãƒ» ' + (reactionMap[r] || r))
      .join('\n') || 'ãƒ» Iâ€™m not fully sure how I reacted today â€” Iâ€™m just starting to notice it.';

    let practiceList = [];
    if (selectedResponses.size > 0) {
      Array.from(selectedResponses).slice(0, 2).forEach(idx => {
        const item = responses[idx];
        if (item) {
          practiceList.push(`ãƒ» ${item.main}\n  ğŸ‘‰ Example line: â€œ${item.say.replace(/^â€œ|â€$/g, '').replace(/^"|"$/g, '')}â€`);
        }
      });
    } else if (responses.length > 0) {
      const item = responses[0];
      practiceList.push(`ãƒ» ${item.main}\n  ğŸ‘‰ Example line: â€œ${item.say.replace(/^â€œ|â€$/g, '').replace(/^"|"$/g, '')}â€`);
    }

    let eventSection = '';
    if (text) {
      const shortText = text.length > 180 ? text.slice(0, 180) + '...' : text;
      eventSection = `ğŸ¯ What happened:
${shortText}

`;
    } else {
      eventSection = `ğŸ¯ What happened:
(I didnâ€™t write details this time, just choosing to pause and reflect.)

`;
    }

    const now = new Date();
    const dateStr = now.toLocaleDateString('en-US');
    const dateTimeStr = now.toLocaleString('en-US');

    const note = `ğŸ“… ${dateStr} | ${template.icon} ${template.name}
ğŸ‘¶ Childâ€™s age: about ${ageNames[currentAge]}

${eventSection}ğŸ’­ How my child might have been feeling:
ãƒ» ${emotions.map(e => e.text).join('\nãƒ» ')}

ğŸ’š What my child might really have needed:
ãƒ» ${needs.map(n => n.text).join('\nãƒ» ')}

ğŸ¤” How I roughly reacted:
${myReactions}

ğŸ’¡ 1â€“2 things Iâ€™d like to try next time:
${practiceList.join('\n') || 'ãƒ» Iâ€™m not sure yet. Iâ€™ll give myself some time and come back to this.'}

â€”â€”â€”
Note created at: ${dateTimeStr}`;

    document.getElementById('noteBox').textContent = note;

    const encouragement = generateEncouragement();
    const encouragementHTML = `
      <div class="encouragement-box">
        <div class="encouragement-title">
          <span>${encouragement.emoji}</span> A few words for you
        </div>
        <div class="encouragement-content">
          <div class="encouragement-highlight">${encouragement.highlight}</div>
          ${encouragement.message.replace(/\n\n/g, '<br><br>')}
        </div>
      </div>
    `;
    document.getElementById('encouragementSection').innerHTML = encouragementHTML;

    const record = {
      id: Date.now(),
      date: now.toISOString(),
      age: currentAge,
      ageName: ageNames[currentAge],
      scenario: currentScenario,
      scenarioName: template.name,
      text: text || '(No detailed description added.)',
      emotions: emotions.map(e => e.text),
      needs: needs.map(n => n.text),
      responses: responses,
      selectedResponseIndexes: Array.from(selectedResponses),
      reactions: Array.from(selectedReactions),
      note: note,
      encouragement: encouragement.message
    };

    const existingIndex = records.findIndex(r => 
      r.scenario === record.scenario && 
      r.text === record.text && 
      Math.abs(new Date(r.date) - new Date(record.date)) < 60000
    );

    if (existingIndex >= 0) {
      records[existingIndex] = record;
    } else {
      records.unshift(record);
    }

    records = records.slice(0, 50);
    saveRecords();
    updateHistoryCount();
  }

  function regenerateNote() {
    generateNote();
  }

  function copyNote() {
    const noteBox = document.getElementById('noteBox');
    const text = noteBox.textContent;
    const copyHint = document.getElementById('copyHint');
    if (!text || text.includes('Please complete the 3 steps on the left first')) {
      alert('Please finish the 3 translation steps before copying your note.');
      return;
    }
    
    const encouragementText = document.querySelector('.encouragement-content')?.textContent || '';
    const fullText = text + (encouragementText ? '\n\nğŸ’ª A small note to myself:\n' + encouragementText : '');
    
    navigator.clipboard.writeText(fullText).then(() => {
      copyHint.textContent = 'âœ… Copied. You can paste this into your notes app, email, or a message to someone you trust.';
      setTimeout(() => {
        copyHint.textContent = '';
      }, 3500);
    }).catch(() => {
      alert('Copy failed. Please select the text manually and copy.');
    });
  }

  // === Weekly review ===
  function displayHistory() {
    const sevenDaysAgo = new Date();
    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

    const recentRecords = records.filter(r => new Date(r.date) >= sevenDaysAgo);

    const historyList = document.getElementById('historyList');
    const summaryBox = document.getElementById('historySummary');

    if (recentRecords.length === 0) {
      historyList.innerHTML = `
        <div class="empty-history">
          <div class="empty-history-icon">ğŸ“­</div>
          <p>No entries in the last 7 days.</p>
          <p style="font-size: 0.9em; color: #999; margin-top: 8px;">Once you complete at least one translation, youâ€™ll start to see your patterns here.</p>
        </div>
      `;
      summaryBox.classList.add('hidden');
      summaryBox.textContent = '';
      return;
    }

    const scenarioCount = {};
    const reactionMapShort = {
      raiseVoice: 'raised voice',
      threaten: 'used threats',
      giveUp: 'gave in / dropped boundaries',
      cold: 'went cold / withdrew',
      compare: 'compared child',
      label: 'used labels',
      empathy: 'named feelings',
      boundary: 'set a boundary',
      repair: 'repaired afterwards',
      tiredBlank: 'felt exhausted'
    };
    const negativeReactions = ['raiseVoice', 'threaten', 'giveUp', 'cold', 'compare', 'label'];
    const positiveReactions = ['empathy', 'boundary', 'repair'];

    let negativeTimes = 0;
    let positiveTimes = 0;

    recentRecords.forEach(r => {
      scenarioCount[r.scenarioName] = (scenarioCount[r.scenarioName] || 0) + 1;
      (r.reactions || []).forEach(re => {
        if (negativeReactions.includes(re)) negativeTimes++;
        if (positiveReactions.includes(re)) positiveTimes++;
      });
    });

    let topScenario = '';
    let topScenarioCount = 0;
    Object.entries(scenarioCount).forEach(([name, count]) => {
      if (count > topScenarioCount) {
        topScenarioCount = count;
        topScenario = name;
      }
    });

    const summaryLines = [];
    summaryLines.push(`In the last 7 days, you logged ${recentRecords.length} parentâ€“child moments.`);
    if (topScenario) {
      summaryLines.push(`The most common situation was: ${topScenario} (about ${topScenarioCount} times).`);
    }
    if (positiveTimes > 0 || negativeTimes > 0) {
      summaryLines.push(`Across these entries, you used â€œempathy / boundaries / repairâ€ about ${positiveTimes} time(s), and had â€œraised voice / threats / withdrawalâ€ type reactions about ${negativeTimes} time(s).`);
      if (positiveTimes > negativeTimes) {
        summaryLines.push('Overall, youâ€™re already leaning more toward connection + clear boundaries, even on hard days.');
      } else {
        summaryLines.push('Even when your reactions feel rough, your willingness to look back at them is a real form of growth.');
      }
    } else {
      summaryLines.push('Youâ€™re building a habit of logging these moments. Over time, checking your own reactions here will show you even more patterns.');
    }

    summaryBox.textContent = summaryLines.join('\n');
    summaryBox.classList.remove('hidden');

    const historyHTML = recentRecords.map(r => {
      const date = new Date(r.date);
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      const dateStr = `${date.getMonth() + 1}/${date.getDate()} ${hours}:${minutes}`;
      
      const eventText = r.text === '(No detailed description added.)' ? '(No detailed description added.)' : r.text;
      
      return `
        <div class="history-item">
          <div class="history-header">
            <div class="history-date">${dateStr}</div>
            <div class="history-scenario">${r.ageName || ''} | ${r.scenarioName}</div>
          </div>
          <div class="history-content">
            <strong>What happened:</strong> ${eventText}<br>
            <strong>Childâ€™s feelings:</strong> ${r.emotions.join(', ')}<br>
            <strong>My reaction:</strong> ${r.reactions.length > 0 ? r.reactions.map(re => reactionMapShort[re] || re).join(', ') : 'not selected'}<br>
          </div>
        </div>
      `;
    }).join('');

    historyList.innerHTML = historyHTML;
  }

  function updateHistoryCount() {
    const sevenDaysAgo = new Date();
    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
    const recentCount = records.filter(r => new Date(r.date) >= sevenDaysAgo).length;
    
    if (recentCount > 0) {
      document.querySelectorAll('.tab-button')[2].innerHTML = `ğŸ“Š Weekly Review (${recentCount})`;
    } else {
      document.querySelectorAll('.tab-button')[2].innerHTML = `ğŸ“Š Weekly Review`;
    }
  }

  function clearAllRecords() {
    if (!confirm('Are you sure you want to clear all saved records?\n(This only deletes data stored in this browser on this device.)')) {
      return;
    }
    records = [];
    saveRecords();
    updateHistoryCount();
    displayHistory();
  }

  window.addEventListener('load', () => {
    initRecords();
    updateHistoryCount();
  });
</script>
</body>
</html>