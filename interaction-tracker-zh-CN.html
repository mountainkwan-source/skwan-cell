<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº²å­äº’åŠ¨æ­£è´Ÿæ¯”ä¾‹æ£€æµ‹è¡¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        /* æ ‡ç­¾é¡µå¯¼èˆª */
        .tab-navigation {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .tab-button {
            flex: 1;
            padding: 18px;
            background: none;
            border: none;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
            font-family: inherit;
        }
        
        .tab-button.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-button:hover {
            background: #e9ecef;
        }
        
        .tab-content {
            display: none;
            padding: 40px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .info-box {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 6px solid #e17055;
        }
        
        .info-box h2 {
            color: #d63031;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .info-box ul {
            list-style: none;
            margin-top: 10px;
        }
        
        .info-box li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            line-height: 1.6;
        }
        
        .info-box li:before {
            content: "ğŸ’¡";
            position: absolute;
            left: 0;
        }
        
        .date-selector {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .date-selector label {
            font-size: 1.2em;
            font-weight: bold;
            margin-right: 15px;
            color: #333;
        }
        
        .date-selector input,
        .date-selector select {
            padding: 10px 15px;
            font-size: 1.1em;
            border: 2px solid #667eea;
            border-radius: 8px;
            outline: none;
            font-family: inherit;
        }
        
        .tracker-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .tracker-box {
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .positive-box {
            background: linear-gradient(135deg, #a8e6cf 0%, #56cc9d 100%);
            border: 3px solid #2ecc71;
        }
        
        .negative-box {
            background: linear-gradient(135deg, #ffb3ba 0%, #ff6b6b 100%);
            border: 3px solid #e74c3c;
        }
        
        .tracker-box h3 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .counter-display {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .counter-number {
            font-size: 4em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .positive-box .counter-number {
            color: #27ae60;
        }
        
        .negative-box .counter-number {
            color: #c0392b;
        }
        
        .counter-label {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .btn-add {
            background: #2ecc71;
            color: white;
        }
        
        .btn-add:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46,204,113,0.4);
        }
        
        .btn-subtract {
            background: #e74c3c;
            color: white;
        }
        
        .btn-subtract:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231,76,60,0.4);
        }
        
        .btn-reset {
            background: #95a5a6;
            color: white;
            margin-top: 10px;
            width: 100%;
        }
        
        .btn-reset:hover {
            background: #7f8c8d;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .examples {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .examples h4 {
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .examples ul {
            list-style: none;
            padding-left: 0;
        }
        
        .examples li {
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .examples li:before {
            content: "â–¸";
            position: absolute;
            left: 5px;
            font-weight: bold;
        }
        
        .result-section {
            background: linear-gradient(135deg, #e8f4f8 0%, #d4e6f1 100%);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 3px solid #3498db;
        }
        
        .result-section h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .ratio-display {
            text-align: center;
            margin: 20px 0;
        }
        
        .ratio-number {
            font-size: 3em;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }
        
        .ratio-bar {
            width: 100%;
            height: 40px;
            background: #ecf0f1;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }
        
        .ratio-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .ratio-bar-negative {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .feedback {
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .feedback-excellent {
            background: #d5f4e6;
            border-left: 5px solid #2ecc71;
            color: #145a32;
        }
        
        .feedback-good {
            background: #fff9e6;
            border-left: 5px solid #f39c12;
            color: #7d6608;
        }
        
        .feedback-warning {
            background: #fadbd8;
            border-left: 5px solid #e74c3c;
            color: #78281f;
        }
        
        .tips-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .tip-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }
        
        .tip-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .tip-card p {
            color: #555;
            line-height: 1.6;
        }
        
        /* å‘¨æŠ¥å‘Šæ ·å¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #667eea30;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 1em;
            color: #666;
        }
        
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .line-chart {
            height: 220px;
            display: flex;
            align-items: flex-end;
            gap: 15px;
            padding: 20px 0;
            position: relative;
        }
        
        .line-bar {
            flex: 1;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px 8px 0 0;
            min-height: 10px;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .line-bar:hover {
            opacity: 0.8;
            transform: translateY(-5px);
        }
        
        .line-bar-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            color: #666;
            white-space: nowrap;
        }
        
        .line-bar-value {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.85em;
            font-weight: bold;
            color: #667eea;
            white-space: nowrap;
        }
        
        /* å†å²è®°å½•æ ·å¼ */
        .history-section {
            margin-top: 0;
            padding: 0;
        }
        
        .history-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .history-list {
            list-style: none;
        }
        
        .history-item {
            background: #f8f9fa;
            padding: 18px 20px;
            margin-bottom: 12px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        
        .history-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .history-date {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.05em;
        }
        
        .history-ratio {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 15px;
            transition: all 0.3s;
        }
        
        .delete-btn:hover {
            background: #c82333;
            transform: scale(1.05);
        }
        
        @media print {
            body {
                background: white;
            }
            .btn, .tab-navigation {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .tracker-section {
                grid-template-columns: 1fr;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.6em;
            }
            
            .counter-number {
                font-size: 3em;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tab-button {
                font-size: 0.9em;
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š äº²å­äº’åŠ¨æ­£è´Ÿæ¯”ä¾‹æ£€æµ‹è¡¨</h1>
            <p class="subtitle">è¿½è¸ªæ¯æ—¥ä¸å­©å­çš„æ­£è´Ÿå‘äº’åŠ¨ï¼Œè¾¾æˆç§‘å­¦å»ºè®®çš„ 5:1 é»„é‡‘æ¯”ä¾‹</p>
        </div>

        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('daily')">ğŸ“… æ¯æ—¥è®°å½•</button>
            <button class="tab-button" onclick="switchTab('report')">ğŸ“Š å‘¨æŠ¥å‘Š</button>
            <button class="tab-button" onclick="switchTab('history')">ğŸ“œ å®Œæ•´è®°å½•</button>
        </div>

        <!-- æ¯æ—¥è®°å½•é¡µé¢ -->
        <div id="dailyTab" class="tab-content active">
            <div class="info-box">
                <h2>ğŸ§  ä»€ä¹ˆæ˜¯è´Ÿé¢åè¯¯ï¼Ÿ</h2>
                <ul>
                    <li>å¤§è„‘å¤©ç”Ÿå¯¹<strong>è´Ÿé¢ä¿¡æ¯</strong>æ›´æ•æ„Ÿã€è®°å¾—æ›´æ·±</li>
                    <li>ç§‘å­¦ç ”ç©¶:éœ€è¦ <strong>5ä¸ªæ­£é¢äº’åŠ¨</strong> æ‰èƒ½æŠµæ¶ˆ <strong>1ä¸ªè´Ÿé¢äº’åŠ¨</strong></li>
                    <li>å­©å­çš„å¤§è„‘ä¼šæ”¾å¤§æ‰¹è¯„ã€ç¼©å°ç§°èµ</li>
                    <li>é•¿æœŸè´Ÿé¢æ¯”ä¾‹è¿‡é«˜ â†’ ç„¦è™‘ã€ä½è‡ªå°Šã€äº²å­å…³ç³»ç–ç¦»</li>
                    <li><strong>å¥½æ¶ˆæ¯ï¼š</strong>é€šè¿‡åˆ»æ„ç»ƒä¹ ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜äº’åŠ¨æ¨¡å¼ï¼</li>
                </ul>
            </div>
            
            <div class="date-selector">
                <label for="date-input">ğŸ“… è®°å½•æ—¥æœŸï¼š</label>
                <input type="date" id="date-input">
            </div>
            
            <div class="tracker-section">
                <!-- æ­£å‘äº’åŠ¨ -->
                <div class="tracker-box positive-box">
                    <h3>âœ… æ­£å‘äº’åŠ¨</h3>
                    <div class="counter-display">
                        <div class="counter-label">ä»Šæ—¥ç´¯è®¡</div>
                        <div class="counter-number" id="positive-count">0</div>
                        <div class="counter-label">æ¬¡</div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-add" onclick="addPositive()">â• å¢åŠ </button>
                        <button class="btn btn-subtract" onclick="subtractPositive()">â– å‡å°‘</button>
                    </div>
                    <button class="btn btn-reset" onclick="resetPositive()">ğŸ”„ é‡ç½®</button>
                    
                    <div class="examples">
                        <h4>æ­£å‘äº’åŠ¨åŒ…æ‹¬:</h4>
                        <ul>
                            <li>å…·ä½“ç§°èµè¡Œä¸º</li>
                            <li>è‚¢ä½“äº²å¯†(æ‹¥æŠ±ã€æ‘¸å¤´)</li>
                            <li>ä¸“æ³¨é™ªä¼´(æ”¾ä¸‹æ‰‹æœº)</li>
                            <li>é¼“åŠ±å’Œè‚¯å®š</li>
                            <li>è€å¿ƒå€¾å¬</li>
                            <li>å¾®ç¬‘å’Œçœ¼ç¥æ¥è§¦</li>
                            <li>è¡¨è¾¾æ„Ÿè°¢</li>
                        </ul>
                    </div>
                </div>
                
                <!-- è´Ÿå‘äº’åŠ¨ -->
                <div class="tracker-box negative-box">
                    <h3>âŒ è´Ÿå‘äº’åŠ¨</h3>
                    <div class="counter-display">
                        <div class="counter-label">ä»Šæ—¥ç´¯è®¡</div>
                        <div class="counter-number" id="negative-count">0</div>
                        <div class="counter-label">æ¬¡</div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-add" onclick="addNegative()">â• å¢åŠ </button>
                        <button class="btn btn-subtract" onclick="subtractNegative()">â– å‡å°‘</button>
                    </div>
                    <button class="btn btn-reset" onclick="resetNegative()">ğŸ”„ é‡ç½®</button>
                    
                    <div class="examples">
                        <h4>è´Ÿå‘äº’åŠ¨åŒ…æ‹¬:</h4>
                        <ul>
                            <li>æ‰¹è¯„ã€è´£éª‚</li>
                            <li>è´Ÿé¢æ ‡ç­¾(ã€Œä½ å¾ˆç¬¨ã€)</li>
                            <li>æ¯”è¾ƒ(ã€Œä½ çœ‹åˆ«äººã€)</li>
                            <li>ä¸è€çƒ¦çš„è¯­æ°”</li>
                            <li>å¿½è§†ã€å†·æ¼ </li>
                            <li>å¨èƒã€æå“</li>
                            <li>ç¿»ç™½çœ¼ã€å¹æ°”</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- ç»“æœåˆ†æ -->
            <div class="result-section">
                <h2>ğŸ“ˆ ä»Šæ—¥äº’åŠ¨æ¯”ä¾‹åˆ†æ</h2>
                
                <div class="ratio-display">
                    <div style="color: #666; margin-bottom: 10px;">æ­£å‘ : è´Ÿå‘ æ¯”ä¾‹</div>
                    <div class="ratio-number" id="ratio-display">-- : --</div>
                </div>
                
                <div class="ratio-bar">
                    <div class="ratio-bar-fill" id="ratio-bar-positive" style="width: 50%;">
                        <span id="positive-percent">0</span>
                    </div>
                    <div class="ratio-bar-negative" id="ratio-bar-negative" style="width: 50%;">
                        <span id="negative-percent">0</span>
                    </div>
                </div>
                
                <div id="feedback" class="feedback"></div>
            </div>
            
            <!-- å®ç”¨å»ºè®® -->
            <div class="tips-section">
                <div class="tip-card">
                    <h4>ğŸ’¡ æå‡æ­£å‘äº’åŠ¨</h4>
                    <p>æ¯å¤©è®¾å®šã€Œç§°èµé—¹é’Ÿã€ï¼Œæ¯2å°æ—¶æé†’è‡ªå·±ä¸»åŠ¨æ‰¾å­©å­çš„å¥½è¡Œä¸ºæ¥è‚¯å®šã€‚è®°ä½ï¼šç§°èµè¦å…·ä½“ï¼</p>
                </div>
                
                <div class="tip-card">
                    <h4>ğŸ¯ å‡å°‘è´Ÿå‘äº’åŠ¨</h4>
                    <p>æƒ³æ‰¹è¯„å‰å…ˆæ·±å‘¼å¸3ç§’ï¼Œé—®è‡ªå·±ï¼šã€Œè¿™å¥è¯10å¹´åå­©å­è¿˜ä¼šè®°å¾—å—ï¼Ÿã€æ¢ä¸ªæ–¹å¼è¡¨è¾¾ä¼šæ›´å¥½ã€‚</p>
                </div>
                
                <div class="tip-card">
                    <h4>ğŸŒŸ ç¡å‰ä»ªå¼</h4>
                    <p>æ¯æ™šç¡å‰å’Œå­©å­åˆ†äº«ã€Œä»Šå¤©3ä»¶å¥½äº‹ã€ï¼Œåˆ»æ„åœ¨å¤§è„‘æ¤å…¥æ­£å‘è®°å¿†ï¼ŒæŠµæ¶ˆè´Ÿé¢åè¯¯ã€‚</p>
                </div>
                
                <div class="tip-card">
                    <h4>ğŸ“ è®°å½•åæ€</h4>
                    <p>æ¯å¤©èŠ±2åˆ†é’Ÿè®°å½•ï¼Œæ¯”ä¾‹ä¸ç†æƒ³æ—¶ä¸è¦è‡ªè´£ï¼Œè¿™æ˜¯è§‰å¯Ÿçš„å¼€å§‹ã€‚æ˜å¤©å†åŠªåŠ›å°±å¥½ï¼</p>
                </div>
            </div>
        </div>

        <!-- å‘¨æŠ¥å‘Šé¡µé¢ -->
        <div id="reportTab" class="tab-content">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #667eea; margin-bottom: 10px;">ğŸ“Š æ¯å‘¨äº’åŠ¨åˆ†ææŠ¥å‘Š</h2>
                <p style="color: #666;">è¿½è¸ªæ‚¨çš„è¿›æ­¥ï¼Œå»ºç«‹æ›´å¥½çš„äº²å­å…³ç³»</p>
            </div>

            <div class="date-selector">
                <label for="weekSelect">é€‰æ‹©å‘¨æ¬¡ï¼š</label>
                <select id="weekSelect" onchange="loadWeekReport()">
                    <option value="current">æœ¬å‘¨</option>
                    <option value="last">ä¸Šå‘¨</option>
                    <option value="last2">ä¸¤å‘¨å‰</option>
                    <option value="last3">ä¸‰å‘¨å‰</option>
                </select>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="weekPositive">0</div>
                    <div class="stat-label">æ­£å‘äº’åŠ¨æ€»æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weekNegative">0</div>
                    <div class="stat-label">è´Ÿå‘äº’åŠ¨æ€»æ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weekAvgRatio">0:0</div>
                    <div class="stat-label">å¹³å‡æ¯”ä¾‹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weekBestDay">--</div>
                    <div class="stat-label">æœ€ä½³è¡¨ç°æ—¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weekRecordDays">0</div>
                    <div class="stat-label">è®°å½•å¤©æ•°</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">ğŸ“ˆ æœ¬å‘¨æ¯æ—¥æ¯”ä¾‹è¶‹åŠ¿</div>
                <div class="line-chart" id="weekLineChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">ğŸ“Š æœ¬å‘¨æ­£è´Ÿå‘äº’åŠ¨å¯¹æ¯”</div>
                <div class="line-chart" id="weekBarChart" style="height: 180px;"></div>
            </div>
        </div>

        <!-- å®Œæ•´è®°å½•é¡µé¢ -->
        <div id="historyTab" class="tab-content">
            <div class="history-section">
                <h3>ğŸ“š æ‰€æœ‰å†å²è®°å½•</h3>
                <div class="button-group" style="margin-bottom: 25px;">
                    <button class="btn btn-secondary" onclick="exportPDF()">ğŸ“„ å¯¼å‡º PDF</button>
                    <button class="btn btn-secondary" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°è®°å½•</button>
                </div>
                <ul class="history-list" id="history-list">
                    <li style="text-align: center; color: #999; padding: 20px;">å°šæ— è®°å½•ï¼Œå¼€å§‹ä»Šå¤©çš„è¿½è¸ªå§ï¼</li>
                </ul>
            </div>
        </div>
    </div>
    <!-- å¼•å…¥ jsPDF å’Œ AutoTable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <script>
        // è‡ªå®šä¹‰å¯¹è¯æ¡†å‡½æ•°
        function showConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed';
            modal.style.cssText = 'position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999;';
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 400px; width: 90%; margin: 20px;">
                    <p style="color: #2c3e50; margin-bottom: 25px; font-size: 1.1em; line-height: 1.6;">${message}</p>
                    <div style="display: flex; justify-content: flex-end; gap: 10px;">
                        <button style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: bold;" onclick="this.closest('.fixed').remove()">å–æ¶ˆ</button>
                        <button style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: bold;" onclick="this.closest('.fixed').remove(); (${onConfirm.toString()})()">ç¡®å®š</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed';
            modal.style.cssText = 'position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 9999;';
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-width: 400px; width: 90%; margin: 20px;">
                    <p style="color: #2c3e50; margin-bottom: 25px; font-size: 1.1em; line-height: 1.6;">${message}</p>
                    <div style="display: flex; justify-content: flex-end;">
                        <button style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: bold;" onclick="this.closest('.fixed').remove()">ç¡®å®š</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // åˆå§‹åŒ–
        let positiveCount = 0;
        let negativeCount = 0;
        let history = JSON.parse(localStorage.getItem('interactionHistory-zh-CN')) || [];
        
        // è®¾å®šä»Šå¤©æ—¥æœŸ
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date-input').value = today;
        
        // è½½å…¥ä»Šå¤©çš„è®°å½•
        loadTodayData();
        updateDisplay();
        displayHistory();
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            if (tabName === 'daily') {
                document.getElementById('dailyTab').classList.add('active');
                document.querySelectorAll('.tab-button')[0].classList.add('active');
            } else if (tabName === 'report') {
                document.getElementById('reportTab').classList.add('active');
                document.querySelectorAll('.tab-button')[1].classList.add('active');
                loadWeekReport();
            } else if (tabName === 'history') {
                document.getElementById('historyTab').classList.add('active');
                document.querySelectorAll('.tab-button')[2].classList.add('active');
                displayHistory();
            }
        }
        
        function addPositive() {
            positiveCount++;
            updateDisplay();
            saveData();
        }
        
        function subtractPositive() {
            if (positiveCount > 0) {
                positiveCount--;
                updateDisplay();
                saveData();
            }
        }
        
        function resetPositive() {
            showConfirmDialog('ç¡®å®šè¦é‡ç½®æ­£å‘è®¡æ•°å—ï¼Ÿ', function() {
                positiveCount = 0;
                updateDisplay();
                saveData();
            });
        }
        
        function addNegative() {
            negativeCount++;
            updateDisplay();
            saveData();
        }
        
        function subtractNegative() {
            if (negativeCount > 0) {
                negativeCount--;
                updateDisplay();
                saveData();
            }
        }
        
        function resetNegative() {
            showConfirmDialog('ç¡®å®šè¦é‡ç½®è´Ÿå‘è®¡æ•°å—ï¼Ÿ', function() {
                negativeCount = 0;
                updateDisplay();
                saveData();
            });
        }
        
        function updateDisplay() {
            // æ›´æ–°è®¡æ•°æ˜¾ç¤º
            document.getElementById('positive-count').textContent = positiveCount;
            document.getElementById('negative-count').textContent = negativeCount;
            
            // è®¡ç®—æ¯”ä¾‹
            let ratio = '';
            let posPercent = 0;
            let negPercent = 0;
            let feedbackText = '';
            let feedbackClass = '';
            
            if (positiveCount === 0 && negativeCount === 0) {
                ratio = '-- : --';
                posPercent = 50;
                negPercent = 50;
                feedbackText = 'å¼€å§‹è®°å½•ä»Šå¤©ä¸å­©å­çš„äº’åŠ¨å§ï¼æ¯ä¸€æ¬¡æœ‰æ„è¯†çš„æ­£å‘äº’åŠ¨ï¼Œéƒ½åœ¨é‡å¡‘å­©å­çš„å¤§è„‘ã€‚';
                feedbackClass = 'feedback-good';
            } else if (negativeCount === 0) {
                ratio = positiveCount + ' : 0';
                posPercent = 100;
                negPercent = 0;
                feedbackText = 'ğŸ‰ å¤ªæ£’äº†ï¼ä»Šå¤©å…¨æ˜¯æ­£å‘äº’åŠ¨ï¼å­©å­çš„å¤§è„‘æ­£åœ¨è¢«çˆ±å’Œè‚¯å®šæ»‹å…»ã€‚ç»§ç»­ä¿æŒï¼';
                feedbackClass = 'feedback-excellent';
            } else {
                const actualRatio = (positiveCount / negativeCount).toFixed(1);
                ratio = actualRatio + ' : 1';
                const total = positiveCount + negativeCount;
                posPercent = Math.round((positiveCount / total) * 100);
                negPercent = Math.round((negativeCount / total) * 100);
                
                if (actualRatio >= 5) {
                    feedbackText = `ğŸŒŸ ä¼˜ç§€ï¼æ¯”ä¾‹è¾¾åˆ° ${actualRatio}:1ï¼Œè¶…è¿‡ç§‘å­¦å»ºè®®çš„ 5:1 é»„é‡‘æ¯”ä¾‹ï¼å­©å­æ­£åœ¨å¥åº·çš„æƒ…ç»ªç¯å¢ƒä¸­æˆé•¿ï¼Œäº²å­å…³ç³»ç¨³å›ºã€‚`;
                    feedbackClass = 'feedback-excellent';
                } else if (actualRatio >= 3) {
                    const need = Math.ceil(negativeCount * 5 - positiveCount);
                    feedbackText = `ğŸ‘ ä¸é”™ï¼æ¯”ä¾‹ ${actualRatio}:1ï¼Œæ¥è¿‘ç›®æ ‡äº†ã€‚å†å¢åŠ  ${need} æ¬¡æ­£å‘äº’åŠ¨å°±èƒ½è¾¾åˆ° 5:1 é»„é‡‘æ¯”ä¾‹ã€‚åŠ æ²¹ï¼`;
                    feedbackClass = 'feedback-good';
                } else if (actualRatio >= 1) {
                    feedbackText = `âš ï¸ éœ€è¦æ”¹å–„ã€‚æ¯”ä¾‹ ${actualRatio}:1 ä½äºå»ºè®®æ ‡å‡†ã€‚è´Ÿé¢äº’åŠ¨å¯¹å­©å­çš„å½±å“æ˜¯æ­£é¢çš„5å€ï¼å»ºè®®ï¼šæš‚åœæ‰¹è¯„ï¼Œä¸“æ³¨ç§°èµå­©å­çš„å¥½è¡Œä¸ºã€‚`;
                    feedbackClass = 'feedback-warning';
                } else {
                    feedbackText = 'ğŸš¨ è­¦ç¤ºï¼è´Ÿå‘äº’åŠ¨å¤šäºæ­£å‘ã€‚è¿™ä¼šä¸¥é‡å½±å“å­©å­çš„è‡ªå°Šå’Œäº²å­å…³ç³»ã€‚å»ºè®®ï¼šä»Šå¤©å‰©ä½™æ—¶é—´åªè¯´æ­£å‘çš„è¯ï¼Œæ˜å¤©é‡æ–°å¼€å§‹ã€‚';
                    feedbackClass = 'feedback-warning';
                }
            }
            
            document.getElementById('ratio-display').textContent = ratio;
            document.getElementById('positive-percent').textContent = posPercent + '%';
            document.getElementById('negative-percent').textContent = negPercent + '%';
            document.getElementById('ratio-bar-positive').style.width = posPercent + '%';
            document.getElementById('ratio-bar-negative').style.width = negPercent + '%';
            
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.textContent = feedbackText;
            feedbackEl.className = 'feedback ' + feedbackClass;
        }
        
        function saveData() {
            const currentDate = document.getElementById('date-input').value;
            const existingIndex = history.findIndex(item => item.date === currentDate);
            
            const record = {
                date: currentDate,
                positive: positiveCount,
                negative: negativeCount,
                ratio: negativeCount === 0 ? positiveCount : (positiveCount / negativeCount).toFixed(1)
            };
            
            if (existingIndex >= 0) {
                history[existingIndex] = record;
            } else {
                history.push(record);
            }
            
            // æ’åºå¹¶ä¿ç•™æ‰€æœ‰è®°å½•
            history.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            localStorage.setItem('interactionHistory-zh-CN', JSON.stringify(history));
            displayHistory();
        }
        
        function loadTodayData() {
            const currentDate = document.getElementById('date-input').value;
            const todayRecord = history.find(item => item.date === currentDate);
            
            if (todayRecord) {
                positiveCount = todayRecord.positive;
                negativeCount = todayRecord.negative;
            } else {
                positiveCount = 0;
                negativeCount = 0;
            }
        }
        
        function displayHistory() {
            const historyList = document.getElementById('history-list');
            
            if (history.length === 0) {
                historyList.innerHTML = '<li style="text-align: center; color: #999; padding: 20px;">å°šæ— è®°å½•ï¼Œå¼€å§‹ä»Šå¤©çš„è¿½è¸ªå§ï¼</li>';
                return;
            }
            
            const weekdayNames = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
            
            historyList.innerHTML = history.map(item => {
                const date = new Date(item.date);
                const dateStr = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()} (${weekdayNames[date.getDay()]})`;
                
                const ratioColor = item.ratio >= 5 ? '#27ae60' : item.ratio >= 3 ? '#f39c12' : '#e74c3c';
                
                return `
                    <li class="history-item">
                        <span class="history-date">${dateStr}</span>
                        <span>æ­£å‘: ${item.positive} | è´Ÿå‘: ${item.negative}</span>
                        <div>
                            <span class="history-ratio" style="color: ${ratioColor}">
                                ${item.negative === 0 ? item.positive + ':0' : item.ratio + ':1'}
                            </span>
                            <button class="delete-btn" onclick="deleteRecord('${item.date}')">åˆ é™¤</button>
                        </div>
                    </li>
                `;
            }).join('');
        }
        
        function deleteRecord(date) {
            showConfirmDialog('ç¡®å®šè¦åˆ é™¤æ­¤è®°å½•å—ï¼Ÿ ' + date, function() {
                history = history.filter(item => item.date !== date);
                localStorage.setItem('interactionHistory-zh-CN', JSON.stringify(history));
                displayHistory();
                
                if (document.getElementById('date-input').value === date) {
                    loadTodayData();
                    updateDisplay();
                }
            });
        }
        
        // å¯¼å‡º PDF (è‹±æ–‡æŠ¥å‘Š)
        function exportPDF() {
            if (history.length === 0) {
                showAlert('æ²¡æœ‰å¯å¯¼å‡ºçš„è®°å½•ï¼');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const totalPositive = history.reduce((sum, item) => sum + item.positive, 0);
            const totalNegative = history.reduce((sum, item) => sum + item.negative, 0);
            const avgRatio = totalNegative === 0 ? 
                (totalPositive > 0 ? totalPositive + ':0' : '0:0') : 
                (totalPositive / totalNegative).toFixed(1) + ':1';
            
            // è‹±æ–‡æ ‡é¢˜
            doc.setFontSize(24);
            doc.setTextColor(102, 126, 234);
            doc.text('Parent-Child Interaction Report', 105, 25, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100);
            doc.text('Positive & Negative Interaction Tracking', 105, 33, { align: 'center' });
            
            doc.setFontSize(10);
            const exportDate = new Date().toLocaleDateString('en-US');
            doc.text('Export Date: ' + exportDate, 105, 42, { align: 'center' });
            
            doc.setDrawColor(102, 126, 234);
            doc.setLineWidth(0.5);
            doc.line(20, 48, 190, 48);
            
            doc.setFontSize(16);
            doc.setTextColor(0);
            doc.setFont(undefined, 'bold');
            doc.text('Summary Statistics', 20, 58);
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            doc.text('Total Record Days: ' + history.length, 25, 68);
            doc.text('Total Positive Interactions: ' + totalPositive, 25, 76);
            doc.text('Total Negative Interactions: ' + totalNegative, 25, 84);
            doc.text('Average Ratio: ' + avgRatio, 25, 92);
            
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text('Target: 5:1 (5 positive interactions for every 1 negative)', 25, 100);
            
            const tableHeaders = ['Date', 'Positive', 'Negative', 'Ratio', 'Status'];
            const statusLabels = ['Excellent', 'Good', 'Fair', 'Need Improvement'];
            
            const tableData = history.map(item => {
                const date = new Date(item.date);
                const dateStr = date.toLocaleDateString('en-US');
                const ratioStr = item.negative === 0 ? `${item.positive}:0` : `${item.ratio}:1`;
                
                let status = '';
                const ratioNum = item.negative === 0 ? item.positive : parseFloat(item.ratio);
                if (ratioNum >= 5) status = statusLabels[0];
                else if (ratioNum >= 3) status = statusLabels[1];
                else if (ratioNum >= 1) status = statusLabels[2];
                else status = statusLabels[3];
                
                return [dateStr, item.positive, item.negative, ratioStr, status];
            });
            
            doc.autoTable({
                startY: 110,
                head: [tableHeaders],
                body: tableData,
                theme: 'grid',
                headStyles: {
                    fillColor: [102, 126, 234],
                    fontSize: 11,
                    fontStyle: 'bold',
                    halign: 'center'
                },
                bodyStyles: {
                    fontSize: 10,
                    halign: 'center'
                },
                columnStyles: {
                    0: { cellWidth: 40 },
                    1: { cellWidth: 30 },
                    2: { cellWidth: 30 },
                    3: { cellWidth: 30 },
                    4: { cellWidth: 45, fontStyle: 'bold' }
                },
                didParseCell: function(data) {
                    if (data.section === 'body' && data.column.index === 4) {
                        const status = data.cell.raw;
                        if (status === statusLabels[0]) {
                            data.cell.styles.textColor = [39, 174, 96];
                        } else if (status === statusLabels[1]) {
                            data.cell.styles.textColor = [243, 156, 18];
                        } else if (status === statusLabels[2]) {
                            data.cell.styles.textColor = [230, 126, 34];
                        } else {
                            data.cell.styles.textColor = [231, 76, 60];
                        }
                    }
                }
            });
            
            const finalY = doc.lastAutoTable.finalY || 110;
            if (finalY < 250) {
                doc.setFontSize(9);
                doc.setTextColor(100);
                doc.text('Note: Research shows that 5 positive interactions are needed to offset 1 negative interaction.', 20, finalY + 15, { maxWidth: 170 });
                doc.text('Maintaining a high positive-to-negative ratio promotes healthy child development.', 20, finalY + 23, { maxWidth: 170 });
            }
            
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150);
                doc.text(`Page ${i} of ${pageCount}`, 105, 285, { align: 'center' });
            }
            
            doc.save('Parent-Child_Interaction_Report_' + new Date().toISOString().split('T')[0] + '.pdf');
        }
        
        // è·å–å‘¨æ¬¡çš„æ—¥æœŸèŒƒå›´
        function getWeekDates(weekType) {
            const today = new Date();
            const currentDay = today.getDay();
            const diff = currentDay === 0 ? 6 : currentDay - 1;
            
            let weekOffset = 0;
            if (weekType === 'last') weekOffset = 7;
            else if (weekType === 'last2') weekOffset = 14;
            else if (weekType === 'last3') weekOffset = 21;

            const monday = new Date(today);
            monday.setDate(today.getDate() - diff - weekOffset);
            
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                dates.push(date.toISOString().split('T')[0]);
            }
            
            return dates;
        }
        
        // è½½å…¥å‘¨æŠ¥å‘Š
        function loadWeekReport() {
            const weekType = document.getElementById('weekSelect').value;
            const weekDates = getWeekDates(weekType);
            
            let totalPositive = 0;
            let totalNegative = 0;
            let recordedDays = 0;
            let bestRatio = 0;
            let bestDay = '--';
            const dailyRatios = [];
            const dailyPositive = [];
            const dailyNegative = [];

            weekDates.forEach(date => {
                const record = history.find(item => item.date === date);
                if (record) {
                    totalPositive += record.positive;
                    totalNegative += record.negative;
                    recordedDays++;
                    
                    const ratio = record.negative === 0 ? record.positive : parseFloat(record.ratio);
                    dailyRatios.push(ratio);
                    dailyPositive.push(record.positive);
                    dailyNegative.push(record.negative);
                    
                    if (ratio > bestRatio) {
                        bestRatio = ratio;
                        const d = new Date(date);
                        bestDay = `${d.getMonth()+1}/${d.getDate()}`;
                    }
                } else {
                    dailyRatios.push(0);
                    dailyPositive.push(0);
                    dailyNegative.push(0);
                }
            });

            const avgRatio = totalNegative === 0 ? 
                (totalPositive > 0 ? totalPositive + ':0' : '0:0') : 
                (totalPositive / totalNegative).toFixed(1) + ':1';

            document.getElementById('weekPositive').textContent = totalPositive;
            document.getElementById('weekNegative').textContent = totalNegative;
            document.getElementById('weekAvgRatio').textContent = avgRatio;
            document.getElementById('weekBestDay').textContent = bestDay;
            document.getElementById('weekRecordDays').textContent = recordedDays;

            // ç»˜åˆ¶æ¯”ä¾‹è¶‹åŠ¿å›¾
            const lineChart = document.getElementById('weekLineChart');
            lineChart.innerHTML = '';
            const maxRatio = Math.max(...dailyRatios, 5);
            const dayNames = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];

            dailyRatios.forEach((ratio, index) => {
                const bar = document.createElement('div');
                bar.className = 'line-bar';
                const height = (ratio / maxRatio) * 100;
                bar.style.height = height + '%';
                bar.style.background = ratio >= 5 ? 
                    'linear-gradient(180deg, #2ecc71 0%, #27ae60 100%)' : 
                    ratio >= 3 ? 
                    'linear-gradient(180deg, #f39c12 0%, #e67e22 100%)' : 
                    'linear-gradient(180deg, #e74c3c 0%, #c0392b 100%)';
                
                const label = document.createElement('div');
                label.className = 'line-bar-label';
                label.textContent = dayNames[index];
                bar.appendChild(label);

                if (ratio > 0) {
                    const value = document.createElement('div');
                    value.className = 'line-bar-value';
                    value.textContent = ratio.toFixed(1);
                    bar.appendChild(value);
                }

                lineChart.appendChild(bar);
            });

            // ç»˜åˆ¶æ­£è´Ÿå‘å¯¹æ¯”å›¾
            const barChart = document.getElementById('weekBarChart');
            barChart.innerHTML = '';
            const maxCount = Math.max(...dailyPositive, ...dailyNegative, 1);

            dailyPositive.forEach((count, index) => {
                const barGroup = document.createElement('div');
                barGroup.style.flex = '1';
                barGroup.style.display = 'flex';
                barGroup.style.flexDirection = 'column';
                barGroup.style.alignItems = 'center';
                barGroup.style.gap = '5px';
                barGroup.style.position = 'relative';
                
                const posBar = document.createElement('div');
                posBar.style.width = '100%';
                posBar.style.height = ((count / maxCount) * 100) + '%';
                posBar.style.background = 'linear-gradient(180deg, #2ecc71 0%, #27ae60 100%)';
                posBar.style.borderRadius = '8px 8px 0 0';
                posBar.style.minHeight = count > 0 ? '10px' : '0';
                
                const negBar = document.createElement('div');
                negBar.style.width = '100%';
                negBar.style.height = ((dailyNegative[index] / maxCount) * 100) + '%';
                negBar.style.background = 'linear-gradient(180deg, #e74c3c 0%, #c0392b 100%)';
                negBar.style.borderRadius = '8px 8px 0 0';
                negBar.style.minHeight = dailyNegative[index] > 0 ? '10px' : '0';
                
                const label = document.createElement('div');
                label.style.fontSize = '0.85em';
                label.style.color = '#666';
                label.style.marginTop = '5px';
                label.textContent = dayNames[index];
                
                barGroup.appendChild(posBar);
                barGroup.appendChild(negBar);
                barGroup.appendChild(label);
                barChart.appendChild(barGroup);
            });
        }
        
        // æ—¥æœŸæ”¹å˜æ—¶è½½å…¥è¯¥æ—¥æœŸçš„èµ„æ–™
        document.getElementById('date-input').addEventListener('change', function() {
            loadTodayData();
            updateDisplay();
        });
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            if (e.key === '+' || e.key === '=') {
                addPositive();
            } else if (e.key === '-' || e.key === '_') {
                addNegative();
            }
        });
    </script>
</body>
</html>